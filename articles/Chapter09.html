<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 9: Bayesian Predictive Analysis ‚Ä¢ BayesianLearningCode</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Chapter 9: Bayesian Predictive Analysis">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BayesianLearningCode</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Chapter01.html">Chapter 1: From Bayes‚Äô Rule to Bayes‚Äô Theorem</a></li>
    <li><a class="dropdown-item" href="../articles/Chapter02.html">Chapter 2: A First Bayesian Analysis of Count Data</a></li>
    <li><a class="dropdown-item" href="../articles/Chapter03.html">Chapter 3: A First Bayesian Analysis of Unknown Probabilities</a></li>
    <li><a class="dropdown-item" href="../articles/Chapter04.html">Chapter 4: A First Bayesian Analysis of Continuous Data</a></li>
    <li><a class="dropdown-item" href="../articles/Chapter05.html">Chapter 5: Learning More About Bayesian Learning</a></li>
    <li><a class="dropdown-item" href="../articles/Chapter06.html">Chapter 6: The Bayesian Approach to Standard Regression Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/Chapter07.html">Chapter 7: Introduction to Bayesian Time Series Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/Chapter08.html">Chapter 8: Beyond Standard Regression Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/Chapter09.html">Chapter 9: Bayesian Predictive Analysis</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Chapter 9: Bayesian Predictive Analysis</h1>
            
      

      <div class="d-none name"><code>Chapter09.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="section-9-1">Section 9.1<a class="anchor" aria-label="anchor" href="#section-9-1"></a>
</h2>
<div class="section level3">
<h3 id="example-9-1-road-safety-data">Example 9.1: Road Safety Data<a class="anchor" aria-label="anchor" href="#example-9-1-road-safety-data"></a>
</h3>
<p>We load the data and extract the observations for the senior people
in Linz. We then plot the pdf and cdf for the predictive distribution
which corresponds under the flat prior to
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>f</mi></msub><mo stretchy="false" form="prefix">|</mo><mi>ùê≤</mi><mo>‚àº</mo><mi>ùí©</mi><mi>B</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>N</mi><mover><mi>y</mi><mo accent="true">‚Äæ</mo></mover><mo>+</mo><mn>1</mn><mo>,</mo><mi>N</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
y_f|\mathbf{y} \sim \mathcal NB(N\bar y + 1, N).
</annotation></semantics></math></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"accidents"</span>, package <span class="op">=</span> <span class="st">"BayesianLearningCode"</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">accidents</span><span class="op">[</span>, <span class="st">"seniors_accidents"</span><span class="op">]</span></span>
<span><span class="op">(</span><span class="va">aN</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1009</span></span>
<span><span class="op">(</span><span class="va">bN</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 192</span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="va">aN</span> <span class="op">/</span> <span class="va">bN</span></span>
<span><span class="va">yf</span> <span class="op">&lt;-</span> <span class="fl">0</span><span class="op">:</span><span class="fl">20</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">yf</span>, <span class="fu"><a href="https://rdrr.io/r/stats/NegBinomial.html" class="external-link">dnbinom</a></span><span class="op">(</span><span class="va">yf</span>, size <span class="op">=</span> <span class="va">aN</span>, mu <span class="op">=</span> <span class="va">mu</span><span class="op">)</span>,</span>
<span>     type <span class="op">=</span> <span class="st">"h"</span>, xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="va">f</span><span class="op">]</span><span class="op">)</span>, ylab <span class="op">=</span> <span class="st">""</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">yf</span>, <span class="fu"><a href="https://rdrr.io/r/stats/NegBinomial.html" class="external-link">pnbinom</a></span><span class="op">(</span><span class="va">yf</span>, size <span class="op">=</span> <span class="va">aN</span>, mu <span class="op">=</span> <span class="va">mu</span><span class="op">)</span>,</span>
<span>     type <span class="op">=</span> <span class="st">"h"</span>, xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="va">f</span><span class="op">]</span><span class="op">)</span>, ylab <span class="op">=</span> <span class="st">""</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">probs</span>, lty <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="va">probs</span>, side <span class="op">=</span> <span class="fl">2</span>, at <span class="op">=</span> <span class="va">probs</span>, adj <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">.8</span>, col <span class="op">=</span> <span class="st">"dimgrey"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Chapter09_files/figure-html/unnamed-chunk-3-1.png" class="r-plt" alt="" width="768"></p>
</div>
<div class="section level3">
<h3 id="example-9-2-exchange-rate-data">Example 9.2: Exchange Rate Data<a class="anchor" aria-label="anchor" href="#example-9-2-exchange-rate-data"></a>
</h3>
<p>We load the data and then plot the pdf and cdf for the predictive
distribution which corresponds under the improper prior to
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>f</mi></msub><mo stretchy="false" form="prefix">|</mo><mi>ùê≤</mi><mo>‚àº</mo><msub><mi>ùìâ</mi><mrow><mn>2</mn><msub><mi>c</mi><mi>N</mi></msub></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mover><mi>y</mi><mo accent="true">‚Äæ</mo></mover><mo>,</mo><mfrac><mrow><mi>N</mi><msubsup><mi>s</mi><mi>y</mi><mn>2</mn></msubsup></mrow><mrow><mi>N</mi><mo>‚àí</mo><mn>1</mn></mrow></mfrac><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>+</mo><mfrac><mn>1</mn><mi>N</mi></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
y_f|\mathbf{y} \sim \mathcal t_{2c_N}\left(\bar y, \frac{N s_y^2}{N-1}\left(1 + \frac{1}{N}\right)\right).
</annotation></semantics></math></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://gregorkastner.github.io/BayesianLearningCode/">"BayesianLearningCode"</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"exrates"</span>, package <span class="op">=</span> <span class="st">"stochvol"</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">exrates</span><span class="op">$</span><span class="va">USD</span> <span class="op">/</span> <span class="va">exrates</span><span class="op">$</span><span class="va">CHF</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ybar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="va">b0</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">N0</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">c0</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span></span>
<span><span class="va">C0</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">BN</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="va">N</span> <span class="op">+</span> <span class="va">N0</span><span class="op">)</span></span>
<span><span class="va">bN</span> <span class="op">&lt;-</span> <span class="va">BN</span> <span class="op">*</span> <span class="op">(</span><span class="va">N</span> <span class="op">*</span> <span class="va">ybar</span> <span class="op">+</span> <span class="va">N0</span> <span class="op">*</span> <span class="va">b0</span><span class="op">)</span></span>
<span><span class="va">cN</span> <span class="op">&lt;-</span> <span class="va">c0</span> <span class="op">+</span> <span class="va">N</span><span class="op">/</span><span class="fl">2</span></span>
<span><span class="va">CN</span> <span class="op">&lt;-</span> <span class="va">C0</span> <span class="op">+</span> <span class="fl">.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="va">ybar</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">N0</span> <span class="op">*</span> <span class="va">N</span> <span class="op">/</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="va">N0</span> <span class="op">+</span> <span class="va">N</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">b0</span> <span class="op">-</span> <span class="va">ybar</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">3</span>, length.out <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="va">scale</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">CN</span> <span class="op">/</span> <span class="va">cN</span> <span class="op">*</span> <span class="op">(</span><span class="va">BN</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="../reference/StudTDist.html">dstudt</a></span><span class="op">(</span><span class="va">x</span>, location <span class="op">=</span> <span class="va">bN</span>, scale <span class="op">=</span> <span class="va">scale</span>, df <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">cN</span><span class="op">)</span>,</span>
<span>     type <span class="op">=</span> <span class="st">"l"</span>, xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="va">f</span><span class="op">]</span><span class="op">)</span>, ylab <span class="op">=</span> <span class="st">""</span>, lwd <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="../reference/StudTDist.html">pstudt</a></span><span class="op">(</span><span class="va">x</span>, location <span class="op">=</span> <span class="va">bN</span>, scale <span class="op">=</span> <span class="va">scale</span>, df <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">cN</span><span class="op">)</span>,</span>
<span>     type <span class="op">=</span> <span class="st">"l"</span>, xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="va">f</span><span class="op">]</span><span class="op">)</span>, ylab <span class="op">=</span> <span class="st">""</span>, lwd <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">probs</span>, lty <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="va">probs</span>, side <span class="op">=</span> <span class="fl">2</span>, at <span class="op">=</span> <span class="va">probs</span>, adj <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">.8</span>, col <span class="op">=</span> <span class="st">"dimgrey"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Chapter09_files/figure-html/unnamed-chunk-4-1.png" class="r-plt" alt="" width="768"></p>
<p>We inspect the parameters of the Student-t distribution.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>mu <span class="op">=</span> <span class="va">bN</span>, sigma2 <span class="op">=</span> <span class="va">scale</span><span class="op">^</span><span class="fl">2</span>, df <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">cN</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;       mu   sigma2       df </span></span>
<span><span class="co">#&gt;    0.018    0.528 3138.000</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-9-3-exchange-rate-data-contd">Example 9.3: Exchange Rate Data cont‚Äôd<a class="anchor" aria-label="anchor" href="#example-9-3-exchange-rate-data-contd"></a>
</h3>
<p>To compare with a method that ignores parameter uncertainty, we now
plot the posterior predictive alongside the ‚Äúclassical‚Äù forecasting
distribution for varying
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Ns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">30</span>, <span class="va">N</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">Ns</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">N</span> <span class="op">&lt;-</span> <span class="va">Ns</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">yshort</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">]</span></span>
<span>  <span class="va">ybar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">yshort</span><span class="op">)</span></span>
<span>  <span class="va">BN</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="va">N</span> <span class="op">+</span> <span class="va">N0</span><span class="op">)</span></span>
<span>  <span class="va">bN</span> <span class="op">&lt;-</span> <span class="va">BN</span> <span class="op">*</span> <span class="op">(</span><span class="va">N</span> <span class="op">*</span> <span class="va">ybar</span> <span class="op">+</span> <span class="va">N0</span> <span class="op">*</span> <span class="va">b0</span><span class="op">)</span></span>
<span>  <span class="va">cN</span> <span class="op">&lt;-</span> <span class="va">c0</span> <span class="op">+</span> <span class="va">N</span><span class="op">/</span><span class="fl">2</span></span>
<span>  <span class="va">CN</span> <span class="op">&lt;-</span> <span class="va">C0</span> <span class="op">+</span> <span class="fl">.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">yshort</span> <span class="op">-</span> <span class="va">ybar</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">N0</span> <span class="op">*</span> <span class="va">N</span> <span class="op">/</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="va">N0</span> <span class="op">+</span> <span class="va">N</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">b0</span> <span class="op">-</span> <span class="va">ybar</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span>  <span class="va">scale</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">CN</span> <span class="op">/</span> <span class="va">cN</span> <span class="op">*</span> <span class="op">(</span><span class="va">BN</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">ybar</span>, <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">yshort</span><span class="op">)</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span>, type <span class="op">=</span> <span class="st">"l"</span>, lwd <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>       xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="va">f</span><span class="op">]</span><span class="op">)</span>, ylab <span class="op">=</span> <span class="st">""</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"N ="</span>, <span class="va">N</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="../reference/StudTDist.html">dstudt</a></span><span class="op">(</span><span class="va">x</span>, location <span class="op">=</span> <span class="va">bN</span>, scale <span class="op">=</span> <span class="va">scale</span>, df <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">cN</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="Chapter09_files/figure-html/unnamed-chunk-6-1.png" class="r-plt" alt="" width="768"></p>
</div>
<div class="section level3">
<h3 id="example-9-4-road-safety-data-contd">Example 9.4: Road Safety Data cont‚Äôd<a class="anchor" aria-label="anchor" href="#example-9-4-road-safety-data-contd"></a>
</h3>
<p>We verify that a 95% predictive interval is given by [1, 9] using the
cdf and compute the effective coverage.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/NegBinomial.html" class="external-link">pnbinom</a></span><span class="op">(</span><span class="fl">9</span>, size <span class="op">=</span> <span class="va">aN</span>, mu <span class="op">=</span> <span class="va">mu</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/NegBinomial.html" class="external-link">pnbinom</a></span><span class="op">(</span><span class="fl">0</span>, size <span class="op">=</span> <span class="va">aN</span>, mu <span class="op">=</span> <span class="va">mu</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.9522248</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-9-5-exchange-rate-data-contd">Example 9.5: Exchange Rate Data cont‚Äôd<a class="anchor" aria-label="anchor" href="#example-9-5-exchange-rate-data-contd"></a>
</h3>
<p>We determine the 95% predictive interval using the quantile
function.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/StudTDist.html">qstudt</a></span><span class="op">(</span><span class="va">probs</span>, location <span class="op">=</span> <span class="va">bN</span>, scale <span class="op">=</span> <span class="va">scale</span>, df <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">cN</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -1.408  1.443</span></span></code></pre></div>
<p>We now work out the effective coverage of the naive interval which
ignores parameter uncertainty.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coverage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA_real_</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Ns</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">coverage</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">Ns</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">Ns</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">N</span> <span class="op">&lt;-</span> <span class="va">Ns</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">yshort</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">]</span></span>
<span>  <span class="va">quants</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">probs</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">yshort</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">yshort</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">coverage</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="fu"><a href="../reference/StudTDist.html">pstudt</a></span><span class="op">(</span><span class="va">quants</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">yshort</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">yshort</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="va">N</span><span class="op">)</span>,</span>
<span>                             <span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="va">c0</span> <span class="op">+</span> <span class="va">N</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">coverage</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">5</th>
<th align="right">10</th>
<th align="right">30</th>
<th align="right">3139</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">0.8519</td>
<td align="right">0.9055</td>
<td align="right">0.9363</td>
<td align="right">0.9499</td>
</tr></tbody>
</table>
</div>
<div class="section level3">
<h3 id="example-9-8-sampling-based-prediction-for-the-chfusd-exchange-rates">Example 9.8: Sampling-based prediction for the CHF/USD exchange
rates<a class="anchor" aria-label="anchor" href="#example-9-8-sampling-based-prediction-for-the-chfusd-exchange-rates"></a>
</h3>
<p>We proceed exactly as in Chapter 4. For the Gaussian distribution,
the posterior of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>œÉ</mi><mn>2</mn></msup><annotation encoding="application/x-tex">\sigma^2</annotation></semantics></math>
is inverse gamma, and we can easily generate iid draws.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">ndraws</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span><span class="va">sigma2draws_normal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/InvGammaDist.html">rinvgamma</a></span><span class="op">(</span><span class="va">ndraws</span>, <span class="va">N</span> <span class="op">/</span> <span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">y</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>For the
Student-<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
model, we can use inverse transform sampling. First, we draw uniformly
from the interval spanned by 0 and the maximum of the non-normalized
cumulative posterior. Then, for each draw, we find the interval of our
pointwise cdf approximation of the posterior, and interpolate linearly
between the interval boundaries.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We need the nonnormalized cumulative posterior distribution</span></span>
<span><span class="va">post_nonnormalized_nonvec</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">sigma2</span>, <span class="va">y</span>, <span class="va">nu</span>, <span class="va">log</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">logdens</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">sigma2</span><span class="op">)</span> <span class="op">-</span></span>
<span>    <span class="op">(</span><span class="va">nu</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">y</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="op">(</span><span class="va">nu</span> <span class="op">*</span> <span class="va">sigma2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">sigma2</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">log</span><span class="op">)</span> <span class="va">logdens</span> <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">logdens</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">post_nonnormalized</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Vectorize.html" class="external-link">Vectorize</a></span><span class="op">(</span><span class="va">post_nonnormalized_nonvec</span>, <span class="st">"sigma2"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now, we compute the pdf and cdf on a reasonably chosen grid</span></span>
<span><span class="va">nu</span> <span class="op">&lt;-</span> <span class="fl">7</span></span>
<span><span class="va">sigma2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.45</span>, length.out <span class="op">=</span> <span class="fl">3000</span><span class="op">)</span></span>
<span><span class="va">pdf_u</span> <span class="op">&lt;-</span> <span class="fu">post_nonnormalized</span><span class="op">(</span><span class="va">sigma2</span>, y <span class="op">=</span> <span class="va">y</span>, nu <span class="op">=</span> <span class="va">nu</span><span class="op">)</span></span>
<span><span class="va">pdf_u</span> <span class="op">&lt;-</span> <span class="va">pdf_u</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">pdf_u</span><span class="op">)</span></span>
<span><span class="va">cdf_u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">pdf_u</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pdf_u</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now we can perform inverse transpose sampling</span></span>
<span><span class="va">unifdraws</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">ndraws</span>, <span class="fl">0</span>, <span class="va">cdf_u</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cdf_u</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">leftind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/findInterval.html" class="external-link">findInterval</a></span><span class="op">(</span><span class="va">unifdraws</span>, <span class="va">cdf_u</span><span class="op">)</span></span>
<span><span class="va">rightind</span> <span class="op">&lt;-</span> <span class="va">leftind</span> <span class="op">+</span> <span class="fl">1L</span></span>
<span><span class="va">distprop</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">unifdraws</span> <span class="op">-</span> <span class="va">cdf_u</span><span class="op">[</span><span class="va">leftind</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">cdf_u</span><span class="op">[</span><span class="va">rightind</span><span class="op">]</span> <span class="op">-</span> <span class="va">cdf_u</span><span class="op">[</span><span class="va">leftind</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">sigma2draws_t</span> <span class="op">&lt;-</span> <span class="va">sigma2</span><span class="op">[</span><span class="va">leftind</span><span class="op">]</span> <span class="op">+</span> <span class="va">distprop</span> <span class="op">*</span></span>
<span>  <span class="op">(</span><span class="va">sigma2</span><span class="op">[</span><span class="va">rightind</span><span class="op">]</span> <span class="op">-</span> <span class="va">sigma2</span><span class="op">[</span><span class="va">leftind</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>Next, we simulate draws from the posterior predictive.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yf_normal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">ndraws</span>, <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">sigma2draws_normal</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">yf_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/StudTDist.html">rstudt</a></span><span class="op">(</span><span class="va">ndraws</span>, <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">sigma2draws_t</span><span class="op">)</span>, <span class="fl">7</span><span class="op">)</span></span></code></pre></div>
<p>Now we can compute their empirical quantiles, and those of the
data.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">quants</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.25</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">0.75</span>, <span class="fl">0.95</span>, <span class="fl">0.99</span><span class="op">)</span></span>
<span><span class="va">q_normal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">yf_normal</span>, <span class="va">quants</span><span class="op">)</span></span>
<span><span class="va">q_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">yf_t</span>, <span class="va">quants</span><span class="op">)</span></span>
<span><span class="va">q_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">quants</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="st">"Data"</span> <span class="op">=</span> <span class="va">q_y</span>, <span class="st">"Student t"</span> <span class="op">=</span> <span class="va">q_t</span>,</span>
<span>                           <span class="st">"Gaussian"</span> <span class="op">=</span> <span class="va">q_normal</span><span class="op">)</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="14%">
<col width="10%">
<col width="10%">
<col width="10%">
<col width="10%">
<col width="8%">
<col width="8%">
<col width="8%">
<col width="8%">
<col width="8%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">1%</th>
<th align="right">5%</th>
<th align="right">25%</th>
<th align="right">40%</th>
<th align="right">50%</th>
<th align="right">60%</th>
<th align="right">75%</th>
<th align="right">95%</th>
<th align="right">99%</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Data</td>
<td align="right">-1.687</td>
<td align="right">-1.078</td>
<td align="right">-0.416</td>
<td align="right">-0.137</td>
<td align="right">0.005</td>
<td align="right">0.159</td>
<td align="right">0.435</td>
<td align="right">1.158</td>
<td align="right">1.864</td>
</tr>
<tr class="even">
<td align="left">Student t</td>
<td align="right">-1.721</td>
<td align="right">-1.119</td>
<td align="right">-0.421</td>
<td align="right">-0.149</td>
<td align="right">0.004</td>
<td align="right">0.164</td>
<td align="right">0.432</td>
<td align="right">1.125</td>
<td align="right">1.741</td>
</tr>
<tr class="odd">
<td align="left">Gaussian</td>
<td align="right">-1.676</td>
<td align="right">-1.185</td>
<td align="right">-0.487</td>
<td align="right">-0.177</td>
<td align="right">0.008</td>
<td align="right">0.185</td>
<td align="right">0.507</td>
<td align="right">1.211</td>
<td align="right">1.704</td>
</tr>
</tbody>
</table>
<p>We conclude by visualizing the data and the predictive
distributions.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">minmax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="fl">10</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">10</span></span>
<span><span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="va">minmax</span>, <span class="va">minmax</span>, length.out <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">y</span>, freq <span class="op">=</span> <span class="cn">FALSE</span>, breaks <span class="op">=</span> <span class="va">grid</span>, border <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Histogram and predictive densitites"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">yf_normal</span>, adjust <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, col <span class="op">=</span> <span class="fl">4</span>, lty <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">yf_t</span>, adjust <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, col <span class="op">=</span> <span class="fl">2</span>, lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Normal"</span>, <span class="st">"Student t"</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">2</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/ts.plot.html" class="external-link">ts.plot</a></span><span class="op">(</span><span class="va">y</span>, main <span class="op">=</span> <span class="st">"Time series plot and some predictive quantiles"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">q_normal</span>, col <span class="op">=</span> <span class="fl">4</span>, lty <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">q_t</span>, col <span class="op">=</span> <span class="fl">2</span>, lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Normal"</span>, <span class="st">"Student t"</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">2</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="Chapter09_files/figure-html/unnamed-chunk-14-1.png" class="r-plt" alt="" width="768"></p>
</div>
<div class="section level3">
<h3 id="example-9-9-predicting-yearly-maxima-for-the-road-safety-data">Example 9.9: Predicting yearly maxima for the road safety data<a class="anchor" aria-label="anchor" href="#example-9-9-predicting-yearly-maxima-for-the-road-safety-data"></a>
</h3>
<p>We use a sampling-based approach to obtain draws from posterior
predictive by first drawing from the posterior
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œº</mi><mo stretchy="false" form="prefix">|</mo><mi>ùï™</mi><mo>‚àº</mo><mi>ùí¢</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>a</mi><mi>N</mi></msub><mo>,</mo><msub><mi>b</mi><mi>N</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mu|\mathbb{y} \sim \mathcal{G}(a_N, b_N)</annotation></semantics></math>.
Then, using these draws as mean parameters for the Poisson likelihood,
we draw 12 times each to obtain yearly predictions. Of these, we take
the maxima.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">accidents</span><span class="op">[</span>, <span class="st">"seniors_accidents"</span><span class="op">]</span></span>
<span><span class="va">aN</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span></span>
<span><span class="va">bN</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="va">mus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="va">ndraws</span>, <span class="va">aN</span>, <span class="va">bN</span><span class="op">)</span></span>
<span><span class="va">yfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">12</span> <span class="op">*</span> <span class="va">ndraws</span>, <span class="va">mus</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span><span class="va">Us</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">yfs</span>, <span class="fl">1</span>, <span class="va">max</span><span class="op">)</span></span></code></pre></div>
<p>Now we visualize.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proportions.html" class="external-link">proportions</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">Us</span><span class="op">)</span><span class="op">)</span>, xlab <span class="op">=</span> <span class="st">"U"</span>, ylab <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">as.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"h"</span>, xlab <span class="op">=</span> <span class="st">"U"</span>, ylab <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">probs</span>, lty <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="va">probs</span>, side <span class="op">=</span> <span class="fl">2</span>, at <span class="op">=</span> <span class="va">probs</span>, adj <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">.8</span>, col <span class="op">=</span> <span class="st">"dimgrey"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Chapter09_files/figure-html/unnamed-chunk-16-1.png" class="r-plt" alt="" width="768"></p>
</div>
<div class="section level3">
<h3 id="example-9-11">Example 9.11<a class="anchor" aria-label="anchor" href="#example-9-11"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span><span class="va">H</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">M</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sylvia Fr√ºhwirth-Schnatter, Bettina Gr√ºn, Gregor Kastner, Helga Wagner.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
