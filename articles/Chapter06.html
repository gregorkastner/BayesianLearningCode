<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 6: The Bayesian Approach to Standard Regression Analysis • BayesianLearningCode</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Chapter 6: The Bayesian Approach to Standard Regression Analysis">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BayesianLearningCode</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Chapter01.html">Chapter 1: From Bayes’ Rule to Bayes’ Theorem</a></li>
    <li><a class="dropdown-item" href="../articles/Chapter02.html">Chapter 2: A First Bayesian Analysis of Count Data</a></li>
    <li><a class="dropdown-item" href="../articles/Chapter03.html">Chapter 3: A First Bayesian Analysis of Unknown Probabilities</a></li>
    <li><a class="dropdown-item" href="../articles/Chapter04.html">Chapter 4: A First Bayesian Analysis of Continuous Data</a></li>
    <li><a class="dropdown-item" href="../articles/Chapter05.html">Chapter 5: Learning More About Bayesian Learning</a></li>
    <li><a class="dropdown-item" href="../articles/Chapter06.html">Chapter 6: The Bayesian Approach to Standard Regression Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/Chapter07.html">Chapter 7: Introduction to Bayesian Time Series Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/Chapter08.html">Chapter 8: Beyond Standard Regression Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/Chapter09.html">Chapter 9: Bayesian Predictive Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/Chapter10.html">Chapter 10: Bayesian Model Selection</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Chapter 6: The Bayesian Approach to Standard Regression Analysis</h1>
            
      

      <div class="d-none name"><code>Chapter06.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="section-6-1-the-standard-linear-regression-model">Section 6.1 The Standard Linear Regression Model<a class="anchor" aria-label="anchor" href="#section-6-1-the-standard-linear-regression-model"></a>
</h2>
<div class="section level4">
<h4 id="example-6-1-movie-data">Example 6.1: Movie data<a class="anchor" aria-label="anchor" href="#example-6-1-movie-data"></a>
</h4>
<p>We use the movie data provided within the package to illustrate the
Bayesian analysis of a regression model. The data set is a preprocessed
version of the one provided by Lehrer and Xi (2017).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://gregorkastner.github.io/BayesianLearningCode/">"BayesianLearningCode"</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"movies"</span>, package <span class="op">=</span> <span class="st">"BayesianLearningCode"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="section-6-2-bayesian-learning-for-a-standard-linear-regression-model">Section 6.2 Bayesian Learning for a Standard Linear Regression
Model<a class="anchor" aria-label="anchor" href="#section-6-2-bayesian-learning-for-a-standard-linear-regression-model"></a>
</h2>
<div class="section level3">
<h3 id="section-6-2-1-bayesian-learning-under-improper-priors">Section 6.2.1 Bayesian Learning Under Improper Priors<a class="anchor" aria-label="anchor" href="#section-6-2-1-bayesian-learning-under-improper-priors"></a>
</h3>
<div class="section level4">
<h4 id="example-6-2-movie-data-analysis-under-improper-prior">Example 6.2: Movie data: Analysis under improper prior<a class="anchor" aria-label="anchor" href="#example-6-2-movie-data-analysis-under-improper-prior"></a>
</h4>
<p>We use as response <code>y</code> the variable
<em>OpenBoxOffice</em>, which contains the box office sales at the
opening weekend in Mio.$, and as covariates the budget (<em>Budget</em>,
in Mio.$) and the number of screens (<em>Screens</em>, in 1000) the film
was forecast to be in theaters six weeks prior to opening.</p>
<p>We center the covariates <em>Budget</em> and <em>Screens</em> at
their means in the data set. Thus, the intercept represents the expected
box office sales at the opening weekend (in Mio.$) of a film with
average budget and forecast to be screened on an average number of
screens in the theaters.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">movies</span><span class="op">[</span>, <span class="st">"OpenBoxOffice"</span><span class="op">]</span></span>
<span><span class="va">covs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Budget"</span>, <span class="st">"Screens"</span><span class="op">)</span></span>
<span><span class="va">covs.cen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">movies</span><span class="op">[</span>, <span class="va">covs</span><span class="op">]</span>, scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># center the covariates</span></span>
<span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>  <span class="co"># number of observations</span></span>
<span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="st">"Intercept"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">N</span><span class="op">)</span>, <span class="va">covs.cen</span><span class="op">)</span><span class="op">)</span> <span class="co"># regressor matrix</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="co"># number of regression effects</span></span></code></pre></div>
<p>We then define a function to compute the parameters of the posterior
distribution of the regression effects under the improper prior
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>β</mi><mo>,</mo><msup><mi>σ</mi><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow><mo>∝</mo><mfrac><mn>1</mn><msup><mi>σ</mi><mn>2</mn></msup></mfrac></mrow><annotation encoding="application/x-tex">p(\beta, \sigma^2) \propto \frac{1}{\sigma^2}</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regression_improper</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>   <span class="va">BN</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/crossprod.html" class="external-link">crossprod</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span></span>
<span>   <span class="va">Xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/crossprod.html" class="external-link">crossprod</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span><span class="op">)</span></span>
<span>   <span class="va">beta.hat</span> <span class="op">&lt;-</span> <span class="va">BN</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Xy</span></span>
<span></span>
<span>   <span class="va">SSR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/crossprod.html" class="external-link">crossprod</a></span><span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta.hat</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>   <span class="va">cN</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">N</span> <span class="op">-</span> <span class="va">d</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>   <span class="va">CN</span> <span class="op">&lt;-</span> <span class="va">SSR</span> <span class="op">/</span> <span class="fl">2</span></span>
<span></span>
<span>   <span class="va">post.var</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">CN</span> <span class="op">/</span> <span class="va">cN</span><span class="op">)</span> <span class="op">*</span> <span class="va">BN</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta.hat <span class="op">=</span> <span class="va">beta.hat</span>, BN <span class="op">=</span> <span class="va">BN</span>, cN <span class="op">=</span> <span class="va">cN</span>, CN <span class="op">=</span> <span class="va">CN</span>, post.var <span class="op">=</span> <span class="va">post.var</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The following table reports the posterior means together with their
equal-tailed 95% credible intervals.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reg.improp</span> <span class="op">&lt;-</span> <span class="fu">regression_improper</span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span><span class="op">)</span></span>
<span></span>
<span><span class="va">beta.hat</span> <span class="op">&lt;-</span> <span class="va">reg.improp</span><span class="op">$</span><span class="va">beta.hat</span></span>
<span><span class="va">post.sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">reg.improp</span><span class="op">$</span><span class="va">post.var</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cN</span> <span class="op">&lt;-</span> <span class="va">reg.improp</span><span class="op">$</span><span class="va">cN</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">qt</a></span><span class="op">(</span><span class="fl">0.025</span>, df <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">cN</span><span class="op">)</span> <span class="op">*</span> <span class="va">post.sd</span> <span class="op">+</span> <span class="va">beta.hat</span>,</span>
<span>                         <span class="va">beta.hat</span>,</span>
<span>                         <span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">qt</a></span><span class="op">(</span><span class="fl">0.975</span>, df <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">cN</span><span class="op">)</span> <span class="op">*</span> <span class="va">post.sd</span> <span class="op">+</span> <span class="va">beta.hat</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>             col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2.5% quantile"</span>, <span class="st">"posterior mean"</span>, <span class="st">"97.5% quantile"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">2.5% quantile</th>
<th align="right">posterior mean</th>
<th align="right">97.5% quantile</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Intercept</td>
<td align="right">15.977</td>
<td align="right">19.110</td>
<td align="right">22.243</td>
</tr>
<tr class="even">
<td align="left">Budget</td>
<td align="right">0.009</td>
<td align="right">0.174</td>
<td align="right">0.339</td>
</tr>
<tr class="odd">
<td align="left">Screens</td>
<td align="right">1.073</td>
<td align="right">1.719</td>
<td align="right">2.365</td>
</tr>
</tbody>
</table>
<p>Based on the posterior means, the expected box office sales on the
opening weekend equal Mio.$ 19.11 for a film with an average
<em>Budget</em> and forecast to be shown on an average number of
<em>Screens</em>. For such a film the expected box office sales on the
opening weekend are Mio.$ 0.174 higher if the budget is Mio.$ 1 higher;
for a film with an average budget to be shown on 1000 screens more the
expected box office sales are Mio.$ 1.719 higher.</p>
<p>To show the uncertainty of the estimates, we plot the (univariate)
marginal posterior distribution of the intercept as well as the
univariate and bivariate marginal posterior distributions of the
covariate effects.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">3</span><span class="op">*</span><span class="va">post.sd</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/layout.html" class="external-link">layout</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>       heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, respect <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">beta.hat</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="va">post.sd</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, df <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">cN</span><span class="op">)</span>,</span>
<span>      from <span class="op">=</span> <span class="va">beta.hat</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">lim</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, to <span class="op">=</span> <span class="va">beta.hat</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">lim</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>      ylab <span class="op">=</span> <span class="st">""</span>, xlab <span class="op">=</span> <span class="st">""</span>, main <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="st">"Intercept"</span>, <span class="fl">1</span>, line <span class="op">=</span> <span class="fl">1.7</span><span class="op">)</span></span>
<span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x1</span>, <span class="va">x2</span><span class="op">)</span> <span class="op">{</span></span>
<span>   <span class="fu">mvtnorm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mvtnorm/man/Mvt.html" class="external-link">dmvt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">x1</span> <span class="op">-</span> <span class="va">beta.hat</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">x2</span> <span class="op">-</span> <span class="va">beta.hat</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                 sigma <span class="op">=</span> <span class="va">reg.improp</span><span class="op">$</span><span class="va">post.var</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>,</span>
<span>                 df <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">reg.improp</span><span class="op">$</span><span class="va">cN</span>, log <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">xx1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="va">lim</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">lim</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, length <span class="op">=</span> <span class="fl">201</span><span class="op">)</span> <span class="op">+</span> <span class="va">beta.hat</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">xx2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="va">lim</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">lim</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, length <span class="op">=</span> <span class="fl">201</span><span class="op">)</span> <span class="op">+</span> <span class="va">beta.hat</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/outer.html" class="external-link">outer</a></span><span class="op">(</span><span class="va">xx1</span>, <span class="va">xx2</span>, <span class="va">f</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/contour.html" class="external-link">contour</a></span><span class="op">(</span><span class="va">xx1</span>, <span class="va">xx2</span>, <span class="va">z</span>, add <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">beta.hat</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">1</span>, line <span class="op">=</span> <span class="fl">1.7</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">beta.hat</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="fl">2</span>, line <span class="op">=</span> <span class="fl">1.7</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mar.x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="op">(</span><span class="va">xx1</span> <span class="op">-</span> <span class="va">beta.hat</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="va">post.sd</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, df <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">reg.improp</span><span class="op">$</span><span class="va">cN</span>,</span>
<span>             log <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">xx1</span>, <span class="va">mar.x1</span>,  type <span class="op">=</span> <span class="st">"l"</span>, xaxt <span class="op">=</span> <span class="st">"n"</span>, ylab <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mar.x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="op">(</span><span class="va">xx2</span> <span class="op">-</span> <span class="va">beta.hat</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="va">post.sd</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, df <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">reg.improp</span><span class="op">$</span><span class="va">cN</span>,</span>
<span>             log <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mar.x2</span>, <span class="va">xx2</span>,  type <span class="op">=</span> <span class="st">"l"</span>, yaxt <span class="op">=</span> <span class="st">"n"</span>, xlab <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<p><img src="Chapter06_files/figure-html/unnamed-chunk-7-1.png" class="r-plt" alt="" width="768"></p>
<p>For completeness we finally report also the posterior mean of the
error variance and its equal-tailed 95% credible interval.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sigma2.hat</span> <span class="op">&lt;-</span> <span class="va">reg.improp</span><span class="op">$</span><span class="va">CN</span> <span class="op">/</span><span class="op">(</span><span class="va">cN</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="../reference/InvGammaDist.html">qinvgamma</a></span><span class="op">(</span><span class="fl">0.025</span>, a <span class="op">=</span> <span class="va">cN</span>, b <span class="op">=</span> <span class="va">reg.improp</span><span class="op">$</span><span class="va">CN</span><span class="op">)</span>,</span>
<span>                         <span class="va">sigma2.hat</span>,</span>
<span>                         <span class="fu"><a href="../reference/InvGammaDist.html">qinvgamma</a></span><span class="op">(</span><span class="fl">0.975</span>, a <span class="op">=</span> <span class="va">cN</span>, b <span class="op">=</span> <span class="va">reg.improp</span><span class="op">$</span><span class="va">CN</span><span class="op">)</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>             col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2.5% quantile"</span>, <span class="st">"posterior mean"</span>, <span class="st">"97.5% quantile"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">2.5% quantile</th>
<th align="right">posterior mean</th>
<th align="right">97.5% quantile</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">178.38</td>
<td align="right">239.07</td>
<td align="right">319.96</td>
</tr></tbody>
</table>
</div>
<div class="section level4">
<h4 id="example-6-3-movie-data-prediction">Example 6.3: Movie data: Prediction<a class="anchor" aria-label="anchor" href="#example-6-3-movie-data-prediction"></a>
</h4>
<p>We are now interested in predicting the box office sales on the
opening weekend. We compute the predicted box office sales for a film
with an average number of <em>Screens</em> for a range of values for
<em>Budget</em>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>Intercept <span class="op">=</span> <span class="fl">1</span>,</span>
<span>               Budget <span class="op">=</span> <span class="op">-</span><span class="fl">30</span><span class="op">:</span><span class="fl">60</span>,</span>
<span>               Screens <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">ypred</span> <span class="op">&lt;-</span> <span class="va">X_new</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta.hat</span> </span>
<span><span class="va">ypred.var</span> <span class="op">&lt;-</span> <span class="va">sigma2.hat</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="op">(</span><span class="va">X_new</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">reg.improp</span><span class="op">$</span><span class="va">BN</span><span class="op">)</span> <span class="op">*</span> <span class="va">X_new</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>The following plot shows the point predictions together with the 50%
and 80% prediction intervals.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">budget</span> <span class="op">&lt;-</span> <span class="va">X_new</span><span class="op">[</span>, <span class="st">"Budget"</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">movies</span><span class="op">[</span>, <span class="st">"Budget"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">budget</span>, <span class="va">ypred</span>, type <span class="op">=</span> <span class="st">"l"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20</span>, <span class="fl">60</span><span class="op">)</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Budget"</span>, ylab <span class="op">=</span> <span class="st">"Predicted box office sales"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pred.levels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">pred.levels</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>   <span class="va">pred.quantile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">qt</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">pred.levels</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>, df <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">cN</span><span class="op">)</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">budget</span>, <span class="va">ypred</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">ypred.var</span><span class="op">)</span><span class="op">*</span><span class="va">pred.quantile</span>, lty <span class="op">=</span> <span class="va">j</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">budget</span>, <span class="va">ypred</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">ypred.var</span><span class="op">)</span><span class="op">*</span><span class="va">pred.quantile</span>, lty <span class="op">=</span> <span class="va">j</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottomright"</span>,</span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Predicted mean"</span>,</span>
<span>         <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">pred.levels</span><span class="op">*</span><span class="fl">100</span>, <span class="st">"% Prediction interval"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       lty <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, lwd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Chapter06_files/figure-html/unnamed-chunk-10-1.png" class="r-plt" alt="" width="768"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y.pred</span> <span class="op">&lt;-</span> <span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta.hat</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">y.pred</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20</span>, <span class="fl">160</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20</span>, <span class="fl">160</span><span class="op">)</span>, </span>
<span>     xlab <span class="op">=</span> <span class="st">"observed sales"</span>, ylab <span class="op">=</span> <span class="st">"predicted sales"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0</span>, b <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="Chapter06_files/figure-html/unnamed-chunk-11-1.png" class="r-plt" alt="" width="768">
The prediction interval is symmetric around the posterior mean, but
obviously the model is not adequate, as the lower limit of the 80%
prediction interval is negative for a budget below approximately Mio.$
55.</p>
<p>We can take into account that box office sales are always positive by
fitting a linear regression model on the log transformed sales.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">log.y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">movies</span><span class="op">[</span>, <span class="st">"OpenBoxOffice"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">reg.lny</span> <span class="op">&lt;-</span> <span class="fu">regression_improper</span><span class="op">(</span><span class="va">log.y</span>, <span class="va">X</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lny.pred</span> <span class="op">&lt;-</span> <span class="va">X_new</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">reg.lny</span><span class="op">$</span><span class="va">beta.hat</span> </span>
<span><span class="va">sigma2.hat</span> <span class="op">&lt;-</span> <span class="va">reg.lny</span><span class="op">$</span><span class="va">CN</span> <span class="op">/</span><span class="op">(</span><span class="va">reg.lny</span><span class="op">$</span><span class="va">cN</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">lny.pred.var</span> <span class="op">&lt;-</span> <span class="va">sigma2.hat</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="op">(</span><span class="va">X_new</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">reg.lny</span><span class="op">$</span><span class="va">BN</span><span class="op">)</span> <span class="op">*</span> <span class="va">X_new</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>From the estimation results we determine the point predictions and
prediction intervals for the logarithm of the box office sales and
exponentiate the results to obtain the predictions for the sales.</p>
<p>The following figure shows the point prediction with the 50% and 80%
prediction intervals for the box office sales for a film shown on an
average number of <em>Screens</em> for a range of values for
<em>Budget</em> derived from this model.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">budget</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">lny.pred</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"l"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20</span>, <span class="fl">60</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Budget"</span>, ylab <span class="op">=</span> <span class="st">"Predicted box office sales"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">pred.levels</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>   <span class="va">pred.quantile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">qt</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">pred.levels</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>, df <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">reg.lny</span><span class="op">$</span><span class="va">cN</span><span class="op">)</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">budget</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">lny.pred</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">lny.pred.var</span><span class="op">)</span><span class="op">*</span><span class="va">pred.quantile</span><span class="op">)</span>, </span>
<span>         col <span class="op">=</span> <span class="st">"blue"</span>, lty <span class="op">=</span> <span class="va">j</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">budget</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">lny.pred</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">lny.pred.var</span><span class="op">)</span><span class="op">*</span><span class="va">pred.quantile</span><span class="op">)</span>, </span>
<span>         col <span class="op">=</span> <span class="st">"blue"</span>, lty <span class="op">=</span> <span class="va">j</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottomright"</span>,</span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Predicted mean"</span>,</span>
<span>         <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">pred.levels</span><span class="op">*</span><span class="fl">100</span>, <span class="st">"% Prediction interval"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       col <span class="op">=</span> <span class="st">"blue"</span>, lty <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, lwd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Chapter06_files/figure-html/unnamed-chunk-13-1.png" class="r-plt" alt="" width="768"></p>
<p>We see that the bounds of the prediction intervals are positive, but
– due to the exponential transformation – the prediction intervals are
no longer symmetric around the point predictions.</p>
<p>Next, we compare the point predictions from both models to the
observed box office sales.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">y.pred</span>,xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20</span>, <span class="fl">160</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20</span>, <span class="fl">160</span><span class="op">)</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Observed sales"</span>, ylab <span class="op">=</span> <span class="st">"Predicted sales"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">y</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">reg.lny</span><span class="op">$</span><span class="va">beta.hat</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"blue"</span>, pch <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0</span>, b <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottomright"</span>,</span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Linear regression on y"</span>, <span class="st">"Linear regression on ln(y)"</span><span class="op">)</span>,</span>
<span>       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"blue"</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="Chapter06_files/figure-html/unnamed-chunk-14-1.png" class="r-plt" alt="" width="768">
We see that the predicted values from the regression model on the
logarithm of the box office sales are slightly better, but the observed
box office sales of Mio.$ 152 are still predicted much too low.</p>
</div>
</div>
<div class="section level3">
<h3 id="section-6-2-2-bayesian-learning-under-conjugate-priors">Section 6.2.2 Bayesian Learning under Conjugate Priors<a class="anchor" aria-label="anchor" href="#section-6-2-2-bayesian-learning-under-conjugate-priors"></a>
</h3>
<p>We next consider regression analysis under a conjugate prior. For
this, we first define a function that yields the parameters of the
posterior distribution.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regression_conjugate</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span>, <span class="va">b0</span> <span class="op">=</span> <span class="fl">0</span>, <span class="va">B0</span> <span class="op">=</span> <span class="fl">10</span>, <span class="va">c0</span> <span class="op">=</span> <span class="fl">0.01</span>, <span class="va">C0</span> <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">b0</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1L</span><span class="op">)</span></span>
<span>    <span class="va">b0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">b0</span>, <span class="va">d</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">is.matrix</a></span><span class="op">(</span><span class="va">B0</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">B0</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1L</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">B0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">B0</span>, <span class="va">d</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">B0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">B0</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">B0.inv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">B0</span><span class="op">)</span></span>
<span>  <span class="va">BN.inv</span> <span class="op">&lt;-</span> <span class="va">B0.inv</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/crossprod.html" class="external-link">crossprod</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">BN</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">BN.inv</span><span class="op">)</span></span>
<span>  <span class="va">bN</span> <span class="op">&lt;-</span> <span class="va">BN</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="op">(</span><span class="va">B0.inv</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">b0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/crossprod.html" class="external-link">crossprod</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">cN</span> <span class="op">&lt;-</span> <span class="va">c0</span> <span class="op">+</span> <span class="va">N</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>  <span class="va">SS.eps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/crossprod.html" class="external-link">crossprod</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">b0</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">B0.inv</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">b0</span> <span class="op">-</span></span>
<span>                         <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">bN</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">BN.inv</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">bN</span><span class="op">)</span></span>
<span>  <span class="va">CN</span> <span class="op">&lt;-</span> <span class="va">C0</span> <span class="op">+</span> <span class="va">SS.eps</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bN <span class="op">=</span> <span class="va">bN</span>, BN <span class="op">=</span> <span class="va">BN</span>, cN <span class="op">=</span> <span class="va">cN</span>, CN <span class="op">=</span> <span class="va">CN</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level4">
<h4 id="example-6-4-movie-data---analysis-under-conjugate-prior">Example 6.4: Movie data - Analysis under conjugate prior<a class="anchor" aria-label="anchor" href="#example-6-4-movie-data---analysis-under-conjugate-prior"></a>
</h4>
<p>We specify a normal prior with mean zero and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>𝐁</mi><mn>0</mn></msub><mo>=</mo><msup><mi>λ</mi><mn>2</mn></msup><mi>𝐈</mi></mrow><annotation encoding="application/x-tex">\mathbf{B}_0=\lambda^2
\mathbf{I}</annotation></semantics></math> with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>λ</mi><mn>2</mn></msup><mo>=</mo><mn>10</mn></mrow><annotation encoding="application/x-tex">\lambda ^2=10</annotation></semantics></math>
on the regression effects and an inverse Gamma prior with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mn>0</mn></msub><mo>=</mo><mn>2.5</mn></mrow><annotation encoding="application/x-tex">c_0=2.5</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mn>0</mn></msub><mo>=</mo><mn>1.5</mn></mrow><annotation encoding="application/x-tex">C_0=1.5</annotation></semantics></math>
on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>σ</mi><mn>2</mn></msup><annotation encoding="application/x-tex">\sigma^2</annotation></semantics></math>.
With this choice of the prior parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>c</mi><mn>0</mn></msub><annotation encoding="application/x-tex">c_0</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>C</mi><mn>0</mn></msub><annotation encoding="application/x-tex">C_0</annotation></semantics></math>
the prior is rather uninformative but guarantees existence of the
posterior variance.</p>
<p>We perform a regression analysis on the box office sales
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
and report the posterior mean of the regression effects together with
the 2.5% and 97.5% quantiles of the posterior distribution in the
following table.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_conj1</span> <span class="op">&lt;-</span> <span class="fu">regression_conjugate</span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span>, b0 <span class="op">=</span> <span class="fl">0</span>, B0 <span class="op">=</span> <span class="fl">10</span>, c0 <span class="op">=</span> <span class="fl">2.5</span>, C0 <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="va">post.sd.conj1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="op">(</span><span class="va">res_conj1</span><span class="op">$</span><span class="va">CN</span> <span class="op">/</span> <span class="va">res_conj1</span><span class="op">$</span><span class="va">cN</span><span class="op">)</span> <span class="op">*</span> <span class="va">res_conj1</span><span class="op">$</span><span class="va">BN</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">qt</a></span><span class="op">(</span><span class="fl">0.025</span>, df <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">res_conj1</span><span class="op">$</span><span class="va">cN</span><span class="op">)</span> <span class="op">*</span> <span class="va">post.sd.conj1</span> <span class="op">+</span> <span class="va">res_conj1</span><span class="op">$</span><span class="va">bN</span>,</span>
<span>   <span class="va">res_conj1</span><span class="op">$</span><span class="va">bN</span>,</span>
<span>   <span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">qt</a></span><span class="op">(</span><span class="fl">0.975</span>, df <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">res_conj1</span><span class="op">$</span><span class="va">cN</span><span class="op">)</span> <span class="op">*</span> <span class="va">post.sd.conj1</span> <span class="op">+</span> <span class="va">res_conj1</span><span class="op">$</span><span class="va">bN</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, </span>
<span>   col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2.5 quantile"</span>, <span class="st">"posterior mean"</span>, <span class="st">"97.5 quantile"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">2.5 quantile</th>
<th align="right">posterior mean</th>
<th align="right">97.5 quantile</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Intercept</td>
<td align="right">16.088</td>
<td align="right">19.090</td>
<td align="right">22.091</td>
</tr>
<tr class="even">
<td align="left">Budget</td>
<td align="right">0.016</td>
<td align="right">0.174</td>
<td align="right">0.332</td>
</tr>
<tr class="odd">
<td align="left">Screens</td>
<td align="right">1.099</td>
<td align="right">1.719</td>
<td align="right">2.339</td>
</tr>
</tbody>
</table>
<p>To illustrate the effects of a tighter prior on the regression
effects, we also compute the posterior distributions for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>λ</mi><mn>2</mn></msup><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\lambda^2=1</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>λ</mi><mn>2</mn></msup><mo>=</mo><mn>0.1</mn></mrow><annotation encoding="application/x-tex">\lambda^2=0.1</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_conj2</span> <span class="op">&lt;-</span> <span class="fu">regression_conjugate</span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span>, b0 <span class="op">=</span> <span class="fl">0</span>, B0 <span class="op">=</span> <span class="fl">1</span>, c0 <span class="op">=</span> <span class="fl">2.5</span>, C0 <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="va">post.sd.conj2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="op">(</span><span class="va">res_conj2</span><span class="op">$</span><span class="va">CN</span> <span class="op">/</span> <span class="va">res_conj2</span><span class="op">$</span><span class="va">cN</span><span class="op">)</span> <span class="op">*</span> <span class="va">res_conj2</span><span class="op">$</span><span class="va">BN</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">res_conj3</span> <span class="op">&lt;-</span> <span class="fu">regression_conjugate</span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span>, b0 <span class="op">=</span> <span class="fl">0</span>, B0 <span class="op">=</span> <span class="fl">0.1</span>, c0 <span class="op">=</span> <span class="fl">2.5</span>, C0 <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="va">post.sd.conj3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="op">(</span><span class="va">res_conj3</span><span class="op">$</span><span class="va">CN</span> <span class="op">/</span> <span class="va">res_conj3</span><span class="op">$</span><span class="va">cN</span><span class="op">)</span> <span class="op">*</span> <span class="va">res_conj3</span><span class="op">$</span><span class="va">BN</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We plot the marginal posteriors together with those under the
improper prior.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">beta.hat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">beta.hat</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="va">post.sd</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, df <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">cN</span><span class="op">)</span>,</span>
<span>         from <span class="op">=</span> <span class="va">beta.hat</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">-</span> <span class="fl">4</span> <span class="op">*</span> <span class="va">post.sd</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, </span>
<span>         to  <span class="op">=</span>  <span class="va">beta.hat</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="fl">4</span> <span class="op">*</span> <span class="va">post.sd</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>         ylab <span class="op">=</span> <span class="st">""</span>, xlab <span class="op">=</span> <span class="st">""</span> , main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">beta.hat</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">res_conj1</span><span class="op">$</span><span class="va">bN</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="va">post.sd.conj1</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, </span>
<span>            df <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">res_conj1</span><span class="op">$</span><span class="va">cN</span><span class="op">)</span>,</span>
<span>         from <span class="op">=</span> <span class="va">res_conj1</span><span class="op">$</span><span class="va">bN</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">-</span> <span class="fl">4</span> <span class="op">*</span> <span class="va">post.sd.conj1</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>         to  <span class="op">=</span>  <span class="va">res_conj1</span><span class="op">$</span><span class="va">bN</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="fl">4</span> <span class="op">*</span> <span class="va">post.sd.conj1</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>         add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="fl">2</span>, lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">res_conj2</span><span class="op">$</span><span class="va">bN</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="va">post.sd.conj2</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, </span>
<span>            df <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">res_conj2</span><span class="op">$</span><span class="va">cN</span><span class="op">)</span>,</span>
<span>         from <span class="op">=</span> <span class="va">res_conj2</span><span class="op">$</span><span class="va">bN</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">-</span> <span class="fl">4</span> <span class="op">*</span> <span class="va">post.sd.conj2</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>         to  <span class="op">=</span>  <span class="va">res_conj2</span><span class="op">$</span><span class="va">bN</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="fl">4</span> <span class="op">*</span> <span class="va">post.sd.conj2</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, </span>
<span>         add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="fl">3</span>,lty <span class="op">=</span> <span class="fl">3</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">res_conj3</span><span class="op">$</span><span class="va">bN</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="va">post.sd.conj3</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, </span>
<span>            df <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">res_conj3</span><span class="op">$</span><span class="va">cN</span><span class="op">)</span>,</span>
<span>         from <span class="op">=</span> <span class="va">res_conj3</span><span class="op">$</span><span class="va">bN</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">-</span> <span class="fl">4</span> <span class="op">*</span> <span class="va">post.sd.conj3</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>         to  <span class="op">=</span>  <span class="va">res_conj3</span><span class="op">$</span><span class="va">bN</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="fl">4</span> <span class="op">*</span> <span class="va">post.sd.conj3</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>         add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="fl">4</span>,lty <span class="op">=</span> <span class="fl">4</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"improper"</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">^</span><span class="fl">2</span>, <span class="st">"="</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">^</span><span class="fl">2</span>, <span class="st">"="</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">^</span><span class="fl">2</span>, <span class="st">"="</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          col <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, lty <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, lwd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="Chapter06_files/figure-html/unnamed-chunk-18-1.png" class="r-plt" alt="" width="768">
There is little difference to the improper prior for the effects of
<em>Budget</em> and <em>Screens</em>, however the intercept is shrunk to
zero for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>λ</mi><mn>2</mn></msup><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\lambda^2=1</annotation></semantics></math>
and even more for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>λ</mi><mn>2</mn></msup><mo>=</mo><mn>0.1</mn></mrow><annotation encoding="application/x-tex">\lambda^2=0.1</annotation></semantics></math>.</p>
<p>To illustrate the effect of the prior we compute the the weight
matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtext mathvariant="bold">𝐖</mtext><annotation encoding="application/x-tex">\textbf{W}</annotation></semantics></math>
for the conjugate prior with mean
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtext mathvariant="bold">𝟎</mtext><annotation encoding="application/x-tex">\textbf{0}</annotation></semantics></math>
and covariance matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>λ</mi><mn>2</mn></msup><mtext mathvariant="bold">𝐈</mtext></mrow><annotation encoding="application/x-tex">\lambda^2 \textbf{I}</annotation></semantics></math>
for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>λ</mi><mn>2</mn></msup><mo>=</mo><mn>0.1</mn></mrow><annotation encoding="application/x-tex">\lambda^2=0.1</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">W</span> <span class="op">&lt;-</span> <span class="va">res_conj3</span><span class="op">$</span><span class="va">BN</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="va">d</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">W</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt;              [,1]     [,2]     [,3]</span></span>
<span><span class="co">#&gt; Intercept 0.09615  0.00000  0.00000</span></span>
<span><span class="co">#&gt; Budget    0.00000  0.00029 -0.00040</span></span>
<span><span class="co">#&gt; Screens   0.00000 -0.00040  0.00451</span></span></code></pre></div>
<p>Obviously the weight of the prior mean is much larger for the
intercept than for the effects of <em>Budget</em> and <em>Screens</em>.
Together with the high value of the posterior mean of the intercept this
explains the considerable shrinkage to zero of the intercept, whereas
the effects of the two covariates are almost unshrunk.</p>
</div>
</div>
<div class="section level3">
<h3 id="regression-analysis-under-the-semi-conjugate-prior">6.3 Regression Analysis under the Semi-Conjugate Prior<a class="anchor" aria-label="anchor" href="#regression-analysis-under-the-semi-conjugate-prior"></a>
</h3>
<p>First, we set up the Gibbs sampler to estimate the parameters of the
regression model under a semi-conjugate prior.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reg_semiconj</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span>, <span class="va">b0</span> <span class="op">=</span> <span class="fl">0</span>, <span class="va">B0</span> <span class="op">=</span> <span class="fl">10000</span>, <span class="va">c0</span> <span class="op">=</span> <span class="fl">2.5</span>, <span class="va">C0</span> <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>                         <span class="va">burnin</span> <span class="op">=</span> <span class="fl">1000L</span>, <span class="va">M</span> <span class="op">=</span> <span class="va">M</span>, <span class="va">start.sigma2</span><span class="op">)</span> <span class="op">{</span></span>
<span>   <span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> </span>
<span>   <span class="va">B0inv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="va">B0</span>, <span class="va">d</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span>
<span>   <span class="va">b0</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">b0</span>, length.out <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span>
<span></span>
<span>   <span class="co"># define quantities for the Gibbs sampler</span></span>
<span>   <span class="va">XX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/crossprod.html" class="external-link">crossprod</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span>   <span class="va">Xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">y</span></span>
<span>   <span class="va">cN</span> <span class="op">&lt;-</span> <span class="va">c0</span> <span class="op">+</span> <span class="va">N</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>    </span>
<span>   <span class="co"># prepare storing of results</span></span>
<span>   <span class="va">betas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA_real_</span>, nrow <span class="op">=</span> <span class="va">M</span>, ncol <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">betas</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span></span>
<span>   <span class="va">sigma2s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA_real_</span>,  <span class="va">M</span><span class="op">)</span></span>
<span></span>
<span>   <span class="co"># starting value for sigma2</span></span>
<span>   <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html" class="external-link">missing</a></span><span class="op">(</span><span class="va">start.sigma2</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>       <span class="va">start.sigma2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>   <span class="op">}</span></span>
<span>   <span class="va">sigma2</span> <span class="op">&lt;-</span> <span class="va">start.sigma2</span></span>
<span>   </span>
<span>   <span class="kw">for</span> <span class="op">(</span><span class="va">m</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">burnin</span> <span class="op">+</span> <span class="va">M</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>       <span class="co"># sample beta from the full conditional</span></span>
<span>       <span class="va">BN</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">B0inv</span> <span class="op">+</span> <span class="va">XX</span> <span class="op">/</span> <span class="va">sigma2</span><span class="op">)</span> </span>
<span>       <span class="va">bN</span> <span class="op">&lt;-</span> <span class="va">BN</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="op">(</span><span class="va">B0inv</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">b0</span> <span class="op">+</span> <span class="va">Xy</span> <span class="op">/</span> <span class="va">sigma2</span><span class="op">)</span></span>
<span>       <span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu">mvtnorm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mvtnorm/man/Mvnorm.html" class="external-link">rmvnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="va">bN</span>, sigma <span class="op">=</span> <span class="va">BN</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>       <span class="co"># sample sigma^2 from its full conditional</span></span>
<span>       <span class="va">eps</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">-</span> <span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta</span></span>
<span>       <span class="va">CN</span> <span class="op">&lt;-</span> <span class="va">C0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/crossprod.html" class="external-link">crossprod</a></span><span class="op">(</span><span class="va">eps</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>       <span class="va">sigma2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/InvGammaDist.html">rinvgamma</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">cN</span>, <span class="va">CN</span><span class="op">)</span></span>
<span>      </span>
<span>       <span class="kw">if</span> <span class="op">(</span><span class="va">m</span> <span class="op">&gt;</span> <span class="va">burnin</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">betas</span><span class="op">[</span><span class="va">m</span> <span class="op">-</span> <span class="va">burnin</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">beta</span></span>
<span>          <span class="va">sigma2s</span><span class="op">[</span><span class="va">m</span> <span class="op">-</span> <span class="va">burnin</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">sigma2</span></span>
<span>       <span class="op">}</span></span>
<span>   <span class="op">}</span></span>
<span>   <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span>post.draws <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>betas <span class="op">=</span> <span class="va">betas</span>, sigma2s <span class="op">=</span> <span class="va">sigma2s</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span>                              </span></code></pre></div>
<div class="section level4">
<h4 id="example-6-5-movie-data---traceplots-of-the-gibbs-sampler">Example 6.5: Movie data - Traceplots of the Gibbs sampler<a class="anchor" aria-label="anchor" href="#example-6-5-movie-data---traceplots-of-the-gibbs-sampler"></a>
</h4>
<p>We run the sampler two times for 1000 draws and to show convergence
to the posterior distribution we start from extreme values for the
innovation variance, once from a very large and once from a very small
value.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">421</span><span class="op">)</span></span>
<span><span class="va">M</span> <span class="op">&lt;-</span> <span class="fl">1000L</span> <span class="co"># number of draws after burn-in</span></span>
<span><span class="va">post.draws1</span> <span class="op">&lt;-</span> <span class="fu">reg_semiconj</span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span>, b0 <span class="op">=</span> <span class="fl">0</span>, B0 <span class="op">=</span> <span class="fl">10000</span>, c0 <span class="op">=</span> <span class="fl">2.5</span>, C0 <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>                           burnin <span class="op">=</span> <span class="fl">0L</span>, M <span class="op">=</span> <span class="va">M</span>, start.sigma2 <span class="op">=</span> <span class="fl">10</span><span class="op">^</span><span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">post.draws2</span> <span class="op">&lt;-</span> <span class="fu">reg_semiconj</span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span>, b0 <span class="op">=</span> <span class="fl">0</span>, B0 <span class="op">=</span> <span class="fl">10000</span>, c0 <span class="op">=</span> <span class="fl">2.5</span>, C0 <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>                           burnin <span class="op">=</span> <span class="fl">0L</span>, M <span class="op">=</span> <span class="va">M</span>, start.sigma2 <span class="op">=</span> <span class="fl">10</span><span class="op">^</span><span class="op">-</span><span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<p>From the trace plots we see that the sampler converges very
quickly.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">post.draws1</span><span class="op">$</span><span class="va">betas</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">post.draws1</span><span class="op">$</span><span class="va">betas</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, xlab <span class="op">=</span> <span class="st">"Draws"</span>, ylab <span class="op">=</span> <span class="st">""</span>,</span>
<span>        main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">post.draws1</span><span class="op">$</span><span class="va">betas</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">post.draws2</span><span class="op">$</span><span class="va">betas</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">post.draws1</span><span class="op">$</span><span class="va">sigma2s</span>, type <span class="op">=</span> <span class="st">"l"</span>, xlab <span class="op">=</span> <span class="st">"Draws"</span>, ylab <span class="op">=</span> <span class="st">""</span>,</span>
<span>     main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Error variance "</span>, <span class="va">sigma</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">post.draws2</span><span class="op">$</span><span class="va">sigma2s</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Chapter06_files/figure-html/unnamed-chunk-22-1.png" class="r-plt" alt="" width="768">
Even though the starting value for the error variance is far from the
posterior distribution the burn-in phase of the sampler is very
short.</p>
</div>
<div class="section level4">
<h4 id="example-6-6-movie-data-analysis-under-the-semi-conjugate-prior">Example 6.6: Movie data: Analysis under the semi-conjugate
prior<a class="anchor" aria-label="anchor" href="#example-6-6-movie-data-analysis-under-the-semi-conjugate-prior"></a>
</h4>
<p>We now include all available covariates in the regression analysis.
As there is only one film with MPAA rating “G”, we merge the two ratings
“G” and “PG” into one category which we define as our baseline.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">movies</span><span class="op">[</span><span class="st">"PG"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span></code></pre></div>
<p>We center all covariates at zero and define the regressor matrix.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Comedy"</span>, <span class="st">"Thriller"</span>, <span class="st">"PG13"</span>, <span class="st">"R"</span>, <span class="st">"Budget"</span>, <span class="st">"Weeks"</span>, <span class="st">"Screens"</span>, </span>
<span>          <span class="st">"S-4-6"</span>, <span class="st">"S-1-3"</span>, <span class="st">"Vol-4-6"</span>, <span class="st">"Vol-1-3"</span><span class="op">)</span></span>
<span><span class="va">covs.cen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">movies</span><span class="op">[</span>, <span class="va">covs</span><span class="op">]</span>, scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>  <span class="co"># number of observations</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="st">"Intercept"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">N</span><span class="op">)</span>, <span class="va">covs.cen</span><span class="op">)</span> <span class="co"># regressor matrix</span></span>
<span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="co"># number regression effects </span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op">-</span> <span class="fl">1</span> <span class="co"># number of regression effects without intercept</span></span></code></pre></div>
<p>Next, we define the prior parameters and run the sampler.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">421</span><span class="op">)</span></span>
<span><span class="va">M</span> <span class="op">&lt;-</span> <span class="fl">20000L</span> <span class="co"># number of draws after burn-in</span></span>
<span><span class="va">post.draws</span> <span class="op">&lt;-</span> <span class="fu">reg_semiconj</span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span>, b0 <span class="op">=</span> <span class="fl">0</span>, B0 <span class="op">=</span> <span class="fl">10000</span>, c0 <span class="op">=</span> <span class="fl">2.5</span>, C0 <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>                           burnin <span class="op">=</span> <span class="fl">1000L</span>, M <span class="op">=</span> <span class="va">M</span><span class="op">)</span></span></code></pre></div>
<p>To summarize the results nicely, we compute equal-tailed 95% credible
intervals for the regression effects.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res.mcmc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">lower</span> <span class="op">=</span> <span class="fl">0.025</span>, <span class="va">upper</span> <span class="op">=</span> <span class="fl">0.975</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">res</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">lower</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">upper</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">lower</span> <span class="op">*</span> <span class="fl">100</span>, <span class="st">"%"</span><span class="op">)</span>, <span class="st">"Posterior mean"</span>, </span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">upper</span> <span class="op">*</span>   <span class="fl">100</span>, <span class="st">"%"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">res</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">beta.sc</span> <span class="op">&lt;-</span> <span class="va">post.draws</span><span class="op">$</span><span class="va">betas</span></span>
<span><span class="va">res_beta.sc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">beta.sc</span>, <span class="fl">2</span>, <span class="va">res.mcmc</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">res_beta.sc</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Intercept"</span>, <span class="va">covs</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">res_beta.sc</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">2.5%</th>
<th align="right">Posterior mean</th>
<th align="right">97.5%</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Intercept</td>
<td align="right">17.492</td>
<td align="right">19.109</td>
<td align="right">20.716</td>
</tr>
<tr class="even">
<td align="left">Comedy</td>
<td align="right">-2.597</td>
<td align="right">1.492</td>
<td align="right">5.553</td>
</tr>
<tr class="odd">
<td align="left">Thriller</td>
<td align="right">-3.886</td>
<td align="right">0.579</td>
<td align="right">4.966</td>
</tr>
<tr class="even">
<td align="left">PG13</td>
<td align="right">-8.535</td>
<td align="right">-2.732</td>
<td align="right">2.993</td>
</tr>
<tr class="odd">
<td align="left">R</td>
<td align="right">-3.643</td>
<td align="right">2.217</td>
<td align="right">8.039</td>
</tr>
<tr class="even">
<td align="left">Budget</td>
<td align="right">0.041</td>
<td align="right">0.128</td>
<td align="right">0.214</td>
</tr>
<tr class="odd">
<td align="left">Weeks</td>
<td align="right">0.017</td>
<td align="right">0.376</td>
<td align="right">0.732</td>
</tr>
<tr class="even">
<td align="left">Screens</td>
<td align="right">0.600</td>
<td align="right">0.968</td>
<td align="right">1.338</td>
</tr>
<tr class="odd">
<td align="left">S-4-6</td>
<td align="right">-4.851</td>
<td align="right">-1.281</td>
<td align="right">2.358</td>
</tr>
<tr class="even">
<td align="left">S-1-3</td>
<td align="right">-1.245</td>
<td align="right">2.464</td>
<td align="right">6.129</td>
</tr>
<tr class="odd">
<td align="left">Vol-4-6</td>
<td align="right">-19.684</td>
<td align="right">-16.726</td>
<td align="right">-13.784</td>
</tr>
<tr class="even">
<td align="left">Vol-1-3</td>
<td align="right">19.256</td>
<td align="right">22.355</td>
<td align="right">25.472</td>
</tr>
</tbody>
</table>
<p>We do the same for the error variances.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sigma2.sc</span> <span class="op">&lt;-</span> <span class="va">post.draws</span><span class="op">$</span><span class="va">sigma2s</span></span>
<span><span class="va">res_sigma2.sc</span> <span class="op">&lt;-</span> <span class="fu">res.mcmc</span><span class="op">(</span><span class="va">sigma2.sc</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">res_sigma2.sc</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">2.5%</th>
<th align="right">Posterior mean</th>
<th align="right">97.5%</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">47.333</td>
<td align="right">63.925</td>
<td align="right">86.247</td>
</tr></tbody>
</table>
<p>Obviously, taking into account more covariates the posterior mean of
the error variance is considerably lower than in the model with only
<em>Budget</em> and <em>Screens</em> used as covariates.</p>
<p>The different signs of the effects of <em>Vol-4-6</em> and
<em>Vol-1-3</em> deserve some further comment. The two covariates are
highly correlated. Due to this high correlation the usual interpretation
of the effect by changing the value of one covariate only does not make
sense. Hence, we predict the change in box office sales for a film where
the twitter volume scores are 1 unit higher in weeks 4-6 as well as
weeks 1-3.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span>, <span class="st">"Vol-4-6"</span><span class="op">]</span>, <span class="va">X</span><span class="op">[</span>, <span class="st">"Vol-1-3"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.84403</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span>, <span class="st">"Vol-4-6"</span><span class="op">]</span>, <span class="va">X</span><span class="op">[</span>, <span class="st">"Vol-1-3"</span><span class="op">]</span>,xlab<span class="op">=</span><span class="st">"Vol-4-6"</span>, ylab<span class="op">=</span><span class="st">"Vol-1-3"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Chapter06_files/figure-html/unnamed-chunk-28-1.png" class="r-plt" alt="" width="768"></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">res_beta.sc</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Vol-4-6"</span>, <span class="st">"Vol-1-3"</span><span class="op">)</span>, <span class="st">"Posterior mean"</span><span class="op">]</span><span class="op">)</span>, </span>
<span>      digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 5.629</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="regression-analysis-based-on-the-horseshoe-prior">6.4 Regression Analysis Based on the Horseshoe Prior<a class="anchor" aria-label="anchor" href="#regression-analysis-based-on-the-horseshoe-prior"></a>
</h2>
<p>A comparison of the normal and the horseshoe prior shows that the
latter has much more mass close to zero and fatter tails.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="op">-</span><span class="fl">4</span>, to <span class="op">=</span> <span class="fl">4</span>, by <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Horseshoe prior</span></span>
<span><span class="co"># Approximated by the result of Theorem 1 in Carvalho and Polson (2010)</span></span>
<span><span class="va">c</span> <span class="op">&lt;-</span>  <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span><span class="op">^</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">l</span> <span class="op">&lt;-</span> <span class="va">c</span> <span class="op">/</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fl">4</span> <span class="op">/</span> <span class="va">beta</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">u</span> <span class="op">&lt;-</span> <span class="va">c</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">/</span> <span class="va">beta</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">beta</span>, <span class="op">(</span><span class="va">u</span> <span class="op">+</span> <span class="va">l</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span>, type <span class="op">=</span> <span class="st">"l"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.55</span><span class="op">)</span>, xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">""</span>, lty <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">beta</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="co"># Standard normal prior</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Horseshoe"</span>, <span class="st">"Standard normal"</span><span class="op">)</span>,</span>
<span>       lty <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"black"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Chapter06_files/figure-html/unnamed-chunk-29-1.png" class="r-plt" alt="" width="768"></p>
<p>We set up the Gibbs sampler of the regression model with a proper
normal prior on the intercept and horseshoe priors on the covariate
effects.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reg_hs</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span>,  <span class="va">b0</span> <span class="op">=</span> <span class="fl">0</span>, <span class="va">B0</span> <span class="op">=</span> <span class="fl">10000</span>, <span class="va">c0</span> <span class="op">=</span> <span class="fl">2.5</span>, <span class="va">C0</span> <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>                   <span class="va">burnin</span> <span class="op">=</span> <span class="fl">1000L</span>, <span class="va">M</span><span class="op">)</span> <span class="op">{</span></span>
<span>   <span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>   <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op">-</span> <span class="fl">1</span></span>
<span>   </span>
<span>   <span class="va">B00inv</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">B0</span> <span class="co"># prior precision for the intercept</span></span>
<span>   <span class="va">b0</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">b0</span>, length.out <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span>
<span></span>
<span>   <span class="co"># prepare storing of results</span></span>
<span>   <span class="va">betas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA_real_</span>, nrow <span class="op">=</span> <span class="va">M</span>, ncol <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">betas</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span>   </span>
<span>   <span class="va">sigma2s</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA_real_</span>, <span class="va">M</span><span class="op">)</span></span>
<span>   <span class="va">tau2s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA_real_</span>, nrow <span class="op">=</span>  <span class="va">M</span>, ncol <span class="op">=</span> <span class="va">p</span><span class="op">)</span></span>
<span>   <span class="va">lambda2s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA_real_</span>,  <span class="va">M</span><span class="op">)</span></span>
<span>   </span>
<span>   <span class="co"># define quantities for the Gibbs sampler</span></span>
<span>   <span class="va">XX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/crossprod.html" class="external-link">crossprod</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span>   <span class="va">Xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/crossprod.html" class="external-link">crossprod</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span><span class="op">)</span></span>
<span>   <span class="va">cN</span><span class="op">=</span><span class="va">c0</span><span class="op">+</span><span class="va">N</span><span class="op">/</span><span class="fl">2</span></span>
<span></span>
<span>   <span class="co"># set starting values </span></span>
<span>   <span class="va">sigma2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>   <span class="va">tau2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">p</span><span class="op">)</span></span>
<span>   <span class="va">lambda2</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span>   <span class="kw">for</span> <span class="op">(</span><span class="va">m</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">burnin</span> <span class="op">+</span> <span class="va">M</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co"># sample  beta from the full conditional</span></span>
<span>      <span class="va">B0inv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">B00inv</span>, <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="va">lambda2</span> <span class="op">*</span> <span class="va">tau2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">BN</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">B0inv</span> <span class="op">+</span> <span class="va">XX</span> <span class="op">/</span> <span class="va">sigma2</span><span class="op">)</span> </span>
<span>      <span class="va">bN</span> <span class="op">&lt;-</span> <span class="va">BN</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="op">(</span><span class="va">B0inv</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">b0</span> <span class="op">+</span> <span class="va">Xy</span> <span class="op">/</span> <span class="va">sigma2</span><span class="op">)</span></span>
<span>  </span>
<span>      <span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu">mvtnorm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mvtnorm/man/Mvnorm.html" class="external-link">rmvnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="va">bN</span>, sigma <span class="op">=</span> <span class="va">BN</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">beta.star</span> <span class="op">&lt;-</span> <span class="va">beta</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="va">d</span><span class="op">]</span></span>
<span>  </span>
<span>      <span class="co"># sample sigma^2 from its full conditional</span></span>
<span>      <span class="va">eps</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">-</span> <span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta</span></span>
<span>      <span class="va">CN</span> <span class="op">&lt;-</span> <span class="va">C0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/crossprod.html" class="external-link">crossprod</a></span><span class="op">(</span><span class="va">eps</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>      <span class="va">sigma2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/InvGammaDist.html">rinvgamma</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">cN</span>, <span class="va">CN</span><span class="op">)</span></span>
<span>  </span>
<span>      <span class="co"># sample tau^2</span></span>
<span>      <span class="va">xi</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="va">p</span>, rate <span class="op">=</span> <span class="fl">1</span> <span class="op">+</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">tau2</span><span class="op">)</span></span>
<span>      <span class="va">tau2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/InvGammaDist.html">rinvgamma</a></span><span class="op">(</span><span class="va">p</span>, <span class="fl">1</span>, <span class="va">xi</span> <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="va">beta.star</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="va">lambda2</span><span class="op">)</span></span>
<span>  </span>
<span>      <span class="co"># sample lambda^2</span></span>
<span>      <span class="va">zeta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="fl">1</span>, rate <span class="op">=</span> <span class="fl">1</span> <span class="op">+</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">lambda2</span><span class="op">)</span></span>
<span>      <span class="va">lambda2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/InvGammaDist.html">rinvgamma</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">(</span><span class="va">p</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span>, <span class="va">zeta</span> <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">beta.star</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="va">tau2</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>      <span class="co"># store results</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">m</span> <span class="op">&gt;</span> <span class="va">burnin</span><span class="op">)</span> <span class="op">{</span></span>
<span>         <span class="va">betas</span><span class="op">[</span><span class="va">m</span> <span class="op">-</span> <span class="va">burnin</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">beta</span></span>
<span>         <span class="va">sigma2s</span><span class="op">[</span><span class="va">m</span> <span class="op">-</span> <span class="va">burnin</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">sigma2</span></span>
<span>         <span class="va">tau2s</span><span class="op">[</span><span class="va">m</span> <span class="op">-</span> <span class="va">burnin</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="va">tau2</span></span>
<span>         <span class="va">lambda2s</span><span class="op">[</span><span class="va">m</span> <span class="op">-</span> <span class="va">burnin</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda2</span></span>
<span>      <span class="op">}</span></span>
<span>   <span class="op">}</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>betas <span class="op">=</span> <span class="va">betas</span>, sigma2s <span class="op">=</span> <span class="va">sigma2s</span>, tau2s <span class="op">=</span> <span class="va">tau2s</span>, lambda2s <span class="op">=</span> <span class="va">lambda2s</span><span class="op">)</span></span>
<span><span class="op">}</span>    </span></code></pre></div>
<div class="section level4">
<h4 id="example-6-7-movie-data---analysis-under-the-horseshoe-prior">Example 6.7: Movie data - Analysis under the Horseshoe prior<a class="anchor" aria-label="anchor" href="#example-6-7-movie-data---analysis-under-the-horseshoe-prior"></a>
</h4>
<p>We estimate the parameters in the regression model with the same
prior on intercept and error variance as in the semi-conjugate prior,
but a horseshoe prior on the covariate effects.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">421</span><span class="op">)</span></span>
<span><span class="va">post.draws.hs</span> <span class="op">&lt;-</span> <span class="fu">reg_hs</span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span>, M <span class="op">=</span> <span class="va">M</span><span class="op">)</span></span></code></pre></div>
<p>Again, we show the posterior mean estimates of the regression effects
together with their equal-tailed 95% credible intervals in a table.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">beta.hs</span> <span class="op">&lt;-</span> <span class="va">post.draws.hs</span><span class="op">$</span><span class="va">betas</span></span>
<span><span class="va">res_beta.hs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">beta.hs</span>, <span class="fl">2</span>, <span class="va">res.mcmc</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">res_beta.hs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">res_beta.hs</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">2.5%</th>
<th align="right">Posterior mean</th>
<th align="right">97.5%</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Intercept</td>
<td align="right">17.515</td>
<td align="right">19.107</td>
<td align="right">20.702</td>
</tr>
<tr class="even">
<td align="left">Comedy</td>
<td align="right">-1.569</td>
<td align="right">0.278</td>
<td align="right">2.811</td>
</tr>
<tr class="odd">
<td align="left">Thriller</td>
<td align="right">-2.247</td>
<td align="right">0.039</td>
<td align="right">2.406</td>
</tr>
<tr class="even">
<td align="left">PG13</td>
<td align="right">-6.208</td>
<td align="right">-1.857</td>
<td align="right">0.792</td>
</tr>
<tr class="odd">
<td align="left">R</td>
<td align="right">-1.355</td>
<td align="right">0.998</td>
<td align="right">5.004</td>
</tr>
<tr class="even">
<td align="left">Budget</td>
<td align="right">0.035</td>
<td align="right">0.126</td>
<td align="right">0.213</td>
</tr>
<tr class="odd">
<td align="left">Weeks</td>
<td align="right">-0.002</td>
<td align="right">0.334</td>
<td align="right">0.679</td>
</tr>
<tr class="even">
<td align="left">Screens</td>
<td align="right">0.587</td>
<td align="right">0.956</td>
<td align="right">1.322</td>
</tr>
<tr class="odd">
<td align="left">S-4-6</td>
<td align="right">-1.546</td>
<td align="right">0.225</td>
<td align="right">1.686</td>
</tr>
<tr class="even">
<td align="left">S-1-3</td>
<td align="right">-0.535</td>
<td align="right">0.763</td>
<td align="right">2.725</td>
</tr>
<tr class="odd">
<td align="left">Vol-4-6</td>
<td align="right">-19.106</td>
<td align="right">-16.148</td>
<td align="right">-13.169</td>
</tr>
<tr class="even">
<td align="left">Vol-1-3</td>
<td align="right">18.659</td>
<td align="right">21.749</td>
<td align="right">24.836</td>
</tr>
</tbody>
</table>
<p>Estimation results are very similar to those under the semi-conjugate
prior for the effects of Budget, Weeks, Screens, Vol-4-6 and Vol-1-3.
For all other covariates the posterior means of their effects are closer
to zero and the 95% posterior intervals are tighter under the horseshoe
than under the semi-conjugate prior, indicating shrinkage to zero.</p>
<p>However, the estimation results on the error variance are very
similar to those under the semi-conjugate prior.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sigma2.hs</span> <span class="op">&lt;-</span> <span class="va">post.draws.hs</span><span class="op">$</span><span class="va">sigma2s</span></span>
<span><span class="va">res_sigma2.hs</span> <span class="op">&lt;-</span> <span class="fu">res.mcmc</span><span class="op">(</span><span class="va">sigma2.hs</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res_sigma2.hs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">res_beta.hs</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">res_sigma2.hs</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">2.5%</th>
<th align="right">Posterior mean</th>
<th align="right">97.5%</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">47.429</td>
<td align="right">63.694</td>
<td align="right">85.307</td>
</tr></tbody>
</table>
<p>We next have a look at the posterior distributions. The plots on the
left hand side show the posterior distribution for the regression
effects under the semi-conjugate prior, those on the right hand side the
posterior distributions under the horseshoe prior. Whereas the posterior
distributions are symmetric under the semi-conjugate prior, this is not
the case under the horseshoe prior.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">br</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">beta.sc</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span>, <span class="va">beta.hs</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">beta.sc</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span>, <span class="va">beta.hs</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span><span class="op">)</span>,</span>
<span>            length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">beta.sc</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, breaks <span class="op">=</span> <span class="va">br</span>, xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">beta.hs</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, breaks <span class="op">=</span> <span class="va">br</span>, xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="Chapter06_files/figure-html/unnamed-chunk-34-1.png" class="r-plt" alt="" width="768"><img src="Chapter06_files/figure-html/unnamed-chunk-34-2.png" class="r-plt" alt="" width="768"></p>
<p>For illustration purposes, we overlay four selected marginal
posteriors in order to illustrate the shrinkage effect.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">selection</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Screens"</span>, <span class="st">"Weeks"</span>, <span class="st">"S-1-3"</span>, <span class="st">"Thriller"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">selection</span><span class="op">)</span> <span class="op">{</span></span>
<span>   <span class="va">breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">beta.sc</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span>, <span class="va">beta.hs</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">beta.sc</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span>, <span class="va">beta.hs</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                 length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span>   <span class="va">h1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">beta.sc</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span>, breaks <span class="op">=</span> <span class="va">breaks</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>   <span class="va">h2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">beta.hs</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span>, breaks <span class="op">=</span> <span class="va">breaks</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>   <span class="va">col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.25</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">h1</span>, main <span class="op">=</span> <span class="va">i</span>, xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">""</span>, freq <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">h1</span><span class="op">$</span><span class="va">density</span>, <span class="va">h2</span><span class="op">$</span><span class="va">density</span><span class="op">)</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">col</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">h2</span>, xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">""</span>, freq <span class="op">=</span> <span class="cn">FALSE</span>, col <span class="op">=</span> <span class="va">col</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, </span>
<span>        add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="Chapter06_files/figure-html/unnamed-chunk-35-1.png" class="r-plt" alt="" width="768"></p>
<p>Next, we investigate the trace plots of the draws from the posterior.
As above, the plots on the left are obtained under the semi-conjugate
prior, those on the right under the horseshoe prior.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">beta.sc</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">""</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">beta.sc</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">beta.hs</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">""</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">beta.sc</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="Chapter06_files/figure-html/unnamed-chunk-36-1.png" class="r-plt" alt="" width="768"><img src="Chapter06_files/figure-html/unnamed-chunk-36-2.png" class="r-plt" alt="" width="768"></p>
<p>To sum up, we visualize the posterior of the effects and
corresponding (square root of the) shrinkage parameters. For visual
inspection, we create a gap plot, where we remove the largest 5% of the
local shrinkage parameter draws and mirror them around 0. That way, we
can easily identify “significant” effects via clear bimodality or even a
gap around zero – hence the name.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tau2.hs</span> <span class="op">&lt;-</span> <span class="va">post.draws.hs</span><span class="op">$</span><span class="va">tau2s</span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">0.05</span></span>
<span><span class="va">truncate</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">alpha</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="va">x</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span> <span class="op">-</span> <span class="va">alpha</span><span class="op">)</span><span class="op">]</span> </span>
<span><span class="va">tau2.hs.trunc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">tau2.hs</span>, <span class="fl">2</span>, <span class="va">truncate</span>, alpha <span class="op">=</span> <span class="va">alpha</span><span class="op">)</span></span>
<span><span class="va">tau.hs.trunc.mirrored</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">tau2.hs.trunc</span><span class="op">)</span>,</span>
<span>                               <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">tau2.hs.trunc</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>On the left, we see the posteriors of the regression effects
posteriors, on the right, we visualize the gap plot.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">beta.hs</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">beta.hs</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">beta.hs</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">beta.hs</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span>, breaks <span class="op">=</span> <span class="va">breaks</span>, xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">""</span>, </span>
<span>       main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Intercept"</span>, <span class="va">covs</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/frame.html" class="external-link">plot.new</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">tau.hs.trunc.mirrored</span><span class="op">[</span>, <span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">tau.hs.trunc.mirrored</span><span class="op">[</span>, <span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">tau.hs.trunc.mirrored</span><span class="op">[</span>, <span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span>, breaks <span class="op">=</span> <span class="va">breaks</span>, xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">""</span>,</span>
<span>         main <span class="op">=</span> <span class="va">covs</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="Chapter06_files/figure-html/unnamed-chunk-38-1.png" class="r-plt" alt="" width="768"></p>
</div>
<div class="section level4">
<h4 id="example-6-8-movie-data--check-convergence-by-a-second-mcmc-run">Example 6.8: Movie data- Check convergence by a second MCMC run<a class="anchor" aria-label="anchor" href="#example-6-8-movie-data--check-convergence-by-a-second-mcmc-run"></a>
</h4>
<p>We verify convergence of the sampler by doing a second run of the six
block sampler in Algorithm 6.2. In the QQ plots of the draws of the
intercept and the error variance, the draws are very close to the
identity line and hence we can conclude that the sampler has
converged.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post.draws.hs2</span> <span class="op">&lt;-</span> <span class="fu">reg_hs</span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span>, M <span class="op">=</span> <span class="va">M</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.0</span>, <span class="fl">2.0</span>, <span class="fl">2.0</span>, <span class="fl">.1</span><span class="op">)</span>, mgp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">.2</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/qqnorm.html" class="external-link">qqplot</a></span><span class="op">(</span><span class="va">post.draws.hs</span><span class="op">$</span><span class="va">betas</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">post.draws.hs2</span><span class="op">$</span><span class="va">betas</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, </span>
<span>       xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">post.draws.hs</span><span class="op">$</span><span class="va">betas</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">post.draws.hs2</span><span class="op">$</span><span class="va">betas</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>       ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">post.draws.hs</span><span class="op">$</span><span class="va">betas</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">post.draws.hs2</span><span class="op">$</span><span class="va">betas</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>       main <span class="op">=</span> <span class="st">"QQ plot for the intercept"</span>, xlab <span class="op">=</span> <span class="st">"First run"</span>, ylab <span class="op">=</span> <span class="st">"Second run"</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0</span>, b <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/qqnorm.html" class="external-link">qqplot</a></span><span class="op">(</span><span class="va">post.draws.hs</span><span class="op">$</span><span class="va">sigma2s</span>, <span class="va">post.draws.hs2</span><span class="op">$</span><span class="va">sigma2s</span>,</span>
<span>       xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">post.draws.hs</span><span class="op">$</span><span class="va">sigma2s</span>, <span class="va">post.draws.hs2</span><span class="op">$</span><span class="va">sigma2s</span><span class="op">)</span>,</span>
<span>       ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">post.draws.hs</span><span class="op">$</span><span class="va">sigma2s</span>, <span class="va">post.draws.hs2</span><span class="op">$</span><span class="va">sigma2s</span><span class="op">)</span>,</span>
<span>       main <span class="op">=</span> <span class="st">"QQ plot for the error variance"</span>,xlab <span class="op">=</span> <span class="st">"First run"</span>, ylab <span class="op">=</span> <span class="st">"Second run"</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0</span>, b <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="Chapter06_files/figure-html/unnamed-chunk-39-1.png" class="r-plt" alt="" width="768"></p>
</div>
<div class="section level4">
<h4 id="example-6-9-movie-data---predictions">Example 6.9: Movie data - Predictions<a class="anchor" aria-label="anchor" href="#example-6-9-movie-data---predictions"></a>
</h4>
<p>We predict the box office sales for different movies: a film with
baseline values in all covariates (A), a film with baseline values in
all covariates except genre <em>Comedy</em> (B) or <em>Thriller</em> (C)
and finally a film of genre <em>Thriller</em> with MPAA rating PG13
(D).</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nf</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span><span class="va">X_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">nf</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="va">nf</span>, ncol <span class="op">=</span> <span class="va">p</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X_new</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span></span>
<span><span class="va">X_new</span><span class="op">[</span><span class="fl">2</span>, <span class="st">"Comedy"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">X_new</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">4</span>, <span class="st">"Thriller"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">X_new</span><span class="op">[</span><span class="fl">3</span>, <span class="st">"PG13"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">X_new</span><span class="op">[</span><span class="fl">4</span>, <span class="st">"R"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">X_new</span><span class="op">[</span>, <span class="st">"Budget"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span></span>
<span><span class="va">ypred.sc</span> <span class="op">&lt;-</span> <span class="va">X_new</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">beta.sc</span><span class="op">)</span> <span class="op">+</span> </span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sigma2.sc</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">sigma2.sc</span><span class="op">)</span><span class="op">)</span>, each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">X_new</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pred.int.sc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">ypred.sc</span>,<span class="fl">1</span>, <span class="va">quantile</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pred.mean.sc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">ypred.sc</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ypred.hs</span> <span class="op">&lt;-</span> <span class="va">X_new</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">beta.hs</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sigma2.hs</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">sigma2.hs</span><span class="op">)</span><span class="op">)</span>, each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">X_new</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">pred.int.hs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">ypred.hs</span>,<span class="fl">1</span>, <span class="va">quantile</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pred.mean.hs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">ypred.hs</span><span class="op">)</span></span></code></pre></div>
<p>We plot the predicted expectation, the median of the predictive
distribution, together with vertical bars indicating the point-wise
equal-tailed 95% predictive interval.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nf</span>, ncol <span class="op">=</span> <span class="fl">3</span>, nrow <span class="op">=</span> <span class="va">nf</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        y <span class="op">=</span> <span class="va">pred.int.sc</span>, col <span class="op">=</span> <span class="st">"blue"</span>, type <span class="op">=</span> <span class="st">"l"</span>, pch <span class="op">=</span> <span class="fl">16</span>, lty <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">40</span><span class="op">)</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="va">nf</span><span class="op">+</span><span class="fl">0.5</span><span class="op">)</span>,</span>
<span>        xlab <span class="op">=</span> <span class="st">"Scenarios"</span>, ylab <span class="op">=</span> <span class="st">"Predicted box office sales"</span>, xaxt <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">nf</span>, y <span class="op">=</span> <span class="va">pred.int.sc</span><span class="op">[</span><span class="fl">2</span>, <span class="op">]</span>, pch <span class="op">=</span> <span class="fl">19</span>, col <span class="op">=</span> <span class="st">"blue"</span>, cex <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">nf</span>, y <span class="op">=</span> <span class="va">pred.mean.sc</span>, pch <span class="op">=</span> <span class="fl">16</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nf</span><span class="op">)</span><span class="op">+</span><span class="fl">0.2</span>, ncol <span class="op">=</span> <span class="fl">3</span>, nrow <span class="op">=</span> <span class="va">nf</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        y <span class="op">=</span> <span class="va">pred.int.hs</span>, col <span class="op">=</span> <span class="st">"blue"</span>, type <span class="op">=</span> <span class="st">"l"</span>, pch <span class="op">=</span> <span class="fl">16</span>, lty <span class="op">=</span> <span class="fl">1</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nf</span><span class="op">)</span><span class="op">+</span><span class="fl">0.2</span>, y <span class="op">=</span> <span class="va">pred.int.hs</span><span class="op">[</span><span class="fl">2</span>, <span class="op">]</span>, pch <span class="op">=</span> <span class="fl">19</span>, col <span class="op">=</span> <span class="st">"blue"</span>, cex <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nf</span><span class="op">)</span><span class="op">+</span><span class="fl">0.2</span>, y <span class="op">=</span> <span class="va">pred.mean.hs</span>, pch <span class="op">=</span> <span class="fl">16</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>     </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span>, at <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">nf</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Chapter06_files/figure-html/unnamed-chunk-41-1.png" class="r-plt" alt="" width="768"></p>
</div>
</div>
<div class="section level2">
<h2 id="section-6-5-shrinkage-beyond-the-horseshoe-prior">Section 6.5: Shrinkage beyond the Horseshoe Prior<a class="anchor" aria-label="anchor" href="#section-6-5-shrinkage-beyond-the-horseshoe-prior"></a>
</h2>
<div class="section level4">
<h4 id="figure-6-11">Figure 6.11<a class="anchor" aria-label="anchor" href="#figure-6-11"></a>
</h4>
<p>We next investigate different shrinkage priors and plot the marginal
prior on a regression coefficient for various choices of the
hyperparameters.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Thanks to Peter Knaus for providing the code</span></span>
<span><span class="co"># Marginal densities for Triple Gamma, Horseshoe, Double Gamma, and LASSO</span></span>
<span></span>
<span><span class="co"># Some functions that return the log-marginal densities</span></span>
<span><span class="co">## Log-marginal and marginal for Triple Gamma</span></span>
<span><span class="va">logmarginal_TG</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">a</span>, <span class="va">c</span>, <span class="va">kappa2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="op">-</span><span class="fl">0.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">4</span><span class="op">*</span><span class="va">pi</span><span class="op">/</span><span class="va">kappa2</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html" class="external-link">lbeta</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">c</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">c</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html" class="external-link">lgamma</a></span><span class="op">(</span><span class="va">c</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu">gsl</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gsl/man/Hyperg.html" class="external-link">hyperg_U</a></span><span class="op">(</span><span class="va">c</span> <span class="op">+</span> <span class="fl">0.5</span>, <span class="op">-</span><span class="va">a</span> <span class="op">+</span> <span class="fl">1.5</span>, <span class="va">kappa2</span><span class="op">*</span><span class="va">a</span><span class="op">*</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="op">(</span><span class="fl">4</span><span class="op">*</span><span class="va">c</span><span class="op">)</span>, give <span class="op">=</span> <span class="cn">FALSE</span>, strict <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">## Log-marginal and marginal for Double Gamma</span></span>
<span><span class="va">logmarginal_DG</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">a</span>, <span class="va">kappa2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fl">0.5</span><span class="op">*</span><span class="op">(</span><span class="va">a</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">a</span><span class="op">*</span><span class="va">kappa2</span><span class="op">)</span>  <span class="op">-</span> <span class="fl">0.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">pi</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="va">a</span><span class="op">-</span><span class="fl">0.5</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html" class="external-link">lgamma</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">a</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Bessel.html" class="external-link">besselK</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">a</span><span class="op">*</span><span class="va">kappa2</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="va">a</span><span class="op">-</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Select color palette</span></span>
<span><span class="va">color</span> <span class="op">&lt;-</span> <span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span><span class="fl">5</span>, <span class="st">"Dark2"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create layout matrix for plots</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/layout.html" class="external-link">layout</a></span><span class="op">(</span>mat <span class="op">=</span> <span class="va">m</span>, heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plots around the origin</span></span>
<span><span class="co"># Draw horseshoe marginal</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="op">(</span><span class="fu">logmarginal_TG</span><span class="op">(</span><span class="va">x</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, to <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">10000</span>, col <span class="op">=</span> <span class="va">color</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">2</span>, ylab <span class="op">=</span> <span class="st">""</span>,</span>
<span>      xlab <span class="op">=</span> <span class="st">""</span>, cex <span class="op">=</span> <span class="fl">3</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>, <span class="fl">4</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="co"># Draw double gamma marginal</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="op">(</span><span class="fu">logmarginal_DG</span><span class="op">(</span><span class="va">x</span>, <span class="fl">0.1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      n <span class="op">=</span> <span class="fl">10000</span>, col <span class="op">=</span> <span class="va">color</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Draw LASSO marginal</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="op">(</span><span class="fu">logmarginal_DG</span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      n <span class="op">=</span> <span class="fl">10000</span>, col <span class="op">=</span> <span class="va">color</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Draw triple gamma marginal</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="op">(</span><span class="fu">logmarginal_TG</span><span class="op">(</span><span class="va">x</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      n <span class="op">=</span> <span class="fl">10000</span>, col <span class="op">=</span> <span class="va">color</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Add labels to x and y axes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>ylab <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">log</span><span class="op">~</span><span class="fu">p</span><span class="op">(</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, line <span class="op">=</span> <span class="fl">2</span>, cex.lab <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span>, line <span class="op">=</span> <span class="fl">3</span>, cex.lab <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plots in the tails</span></span>
<span><span class="co"># Draw horseshoe marginal</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="op">(</span><span class="fu">logmarginal_TG</span><span class="op">(</span><span class="va">x</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      from <span class="op">=</span> <span class="fl">6</span>, to <span class="op">=</span> <span class="fl">11</span>, n <span class="op">=</span> <span class="fl">10000</span>, col <span class="op">=</span> <span class="va">color</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">2</span>, ylab <span class="op">=</span> <span class="st">""</span>,</span>
<span>      xlab <span class="op">=</span> <span class="st">""</span>, cex <span class="op">=</span> <span class="fl">3</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">18</span>,<span class="op">-</span><span class="fl">5</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="co"># Draw double gamma marginal</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="op">(</span><span class="fu">logmarginal_DG</span><span class="op">(</span><span class="va">x</span>, <span class="fl">0.1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      n <span class="op">=</span> <span class="fl">10000</span>, col <span class="op">=</span> <span class="va">color</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Draw LASSO marginal</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="op">(</span><span class="fu">logmarginal_DG</span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      n <span class="op">=</span> <span class="fl">10000</span>, col <span class="op">=</span> <span class="va">color</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Draw triple gamma marginal</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="op">(</span><span class="fu">logmarginal_TG</span><span class="op">(</span><span class="va">x</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      n <span class="op">=</span> <span class="fl">10000</span>, col <span class="op">=</span> <span class="va">color</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Add labels to x and y axes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>ylab <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">log</span><span class="op">~</span><span class="fu">p</span><span class="op">(</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, line <span class="op">=</span> <span class="fl">2</span>, cex.lab <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span>, line <span class="op">=</span> <span class="fl">3</span>, cex.lab <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create legend at bottom of plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span>, type <span class="op">=</span> <span class="st">"n"</span>, axes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"top"</span>,  inset <span class="op">=</span> <span class="fl">0</span>,</span>
<span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Normal Gamma Gamma"</span>, <span class="st">"Horseshoe"</span>, <span class="st">"Normal Gamma"</span>, <span class="st">"Lasso"</span><span class="op">)</span>,</span>
<span>       col <span class="op">=</span> <span class="va">color</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span>,</span>
<span>       lwd <span class="op">=</span> <span class="fl">2</span>, cex <span class="op">=</span> <span class="fl">1</span>, horiz <span class="op">=</span> <span class="cn">TRUE</span>, xjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="Chapter06_files/figure-html/unnamed-chunk-42-1.png" class="r-plt" alt="" width="864"></p>
<p>The shrinkage profiles of these priors are visualized in the
following plot.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Thanks again to Peter Knaus for providing the code</span></span>
<span><span class="co"># Some functions that return shrinkage profiles</span></span>
<span><span class="co"># Shrinkage profile for triple gamma</span></span>
<span><span class="va">dTPB</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">a</span>, <span class="va">c</span>, <span class="va">phi</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html" class="external-link">lgamma</a></span><span class="op">(</span><span class="va">a</span> <span class="op">+</span> <span class="va">c</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html" class="external-link">lgamma</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html" class="external-link">lgamma</a></span><span class="op">(</span><span class="va">c</span><span class="op">)</span> <span class="op">+</span> <span class="va">c</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">phi</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="op">(</span><span class="va">c</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">a</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="va">a</span><span class="op">+</span><span class="va">c</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="va">phi</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># Shrinkage profile for double gamma</span></span>
<span><span class="va">dTPB_DG</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">a</span>, <span class="va">k2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Special.html" class="external-link">lgamma</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="op">+</span> <span class="va">a</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">a</span><span class="op">*</span><span class="va">k2</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="op">(</span><span class="va">a</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="va">a</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">x</span><span class="op">)</span><span class="op">/</span><span class="va">x</span><span class="op">*</span><span class="va">a</span><span class="op">*</span><span class="va">k2</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Set up plotting area</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">0</span>, <span class="fl">12.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Choose color palette</span></span>
<span><span class="va">color</span> <span class="op">&lt;-</span> <span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span><span class="fl">5</span>, <span class="st">"Dark2"</span><span class="op">)</span></span>
<span><span class="co"># Draw shrinkage profile of horsehoe</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="op">(</span><span class="fu">dTPB</span><span class="op">(</span><span class="va">x</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      from <span class="op">=</span> <span class="fl">0</span>, to <span class="op">=</span> <span class="fl">1</span>, n <span class="op">=</span> <span class="fl">1000</span>, col <span class="op">=</span> <span class="va">color</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">2</span>, ylab <span class="op">=</span> <span class="st">""</span>,</span>
<span>      xlab <span class="op">=</span> <span class="st">""</span>, cex <span class="op">=</span> <span class="fl">3</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="co"># Draw shrinkage profile of double gamma</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="op">(</span><span class="fu">dTPB_DG</span><span class="op">(</span><span class="va">x</span>, <span class="fl">0.1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      n <span class="op">=</span> <span class="fl">1000</span>, col <span class="op">=</span> <span class="va">color</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Draw shrinkage profile of lasso</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="op">(</span><span class="fu">dTPB_DG</span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">1000</span>, col <span class="op">=</span> <span class="va">color</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Draw shrinkage profile of triple gamma</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="op">(</span><span class="fu">dTPB</span><span class="op">(</span><span class="va">x</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      n <span class="op">=</span> <span class="fl">1000</span>, col <span class="op">=</span> <span class="va">color</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Add labels to x and y axes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu">p</span><span class="op">(</span><span class="va">kappa</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, line <span class="op">=</span> <span class="fl">2</span>, cex.lab <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">kappa</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span>, line <span class="op">=</span> <span class="fl">2</span>, cex.lab <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>xpd <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1.05</span>, y <span class="op">=</span> <span class="fl">3</span>,</span>
<span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Normal Gamma Gamma"</span>, <span class="st">"Horseshoe"</span>, <span class="st">"Normal Gamma"</span>, <span class="st">"Lasso"</span><span class="op">)</span>,</span>
<span>       col <span class="op">=</span> <span class="va">color</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span>, bty <span class="op">=</span> <span class="st">"n"</span>,</span>
<span>       lwd <span class="op">=</span> <span class="fl">2</span>, cex <span class="op">=</span> <span class="fl">1</span>, horiz <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="Chapter06_files/figure-html/unnamed-chunk-43-1.png" class="r-plt" alt="" width="864"></p>
</div>
<div class="section level4">
<h4 id="example-6-11-a-hierarchical-bayesian-lasso-prior">Example 6.11: A hierarchical Bayesian lasso prior<a class="anchor" aria-label="anchor" href="#example-6-11-a-hierarchical-bayesian-lasso-prior"></a>
</h4>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">beta2</span> <span class="op">&lt;-</span> <span class="va">beta1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, to <span class="op">=</span> <span class="fl">2</span>, by <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x1</span>, <span class="va">x2</span><span class="op">)</span> <span class="op">{</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">a</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="op">+</span> <span class="va">a</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="va">a</span><span class="op">+</span><span class="fl">2</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">a</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">x1</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4.5</span>, <span class="fl">4.5</span>, <span class="fl">.1</span>, <span class="fl">.1</span><span class="op">)</span>, </span>
<span>    mgp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.6</span>, <span class="fl">.6</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">a</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>   <span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/outer.html" class="external-link">outer</a></span><span class="op">(</span><span class="va">beta1</span>, <span class="va">beta2</span>, <span class="va">f</span><span class="op">)</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/graphics/contour.html" class="external-link">contour</a></span><span class="op">(</span><span class="va">beta1</span>, <span class="va">beta2</span>, <span class="va">z</span>, nlevels <span class="op">=</span> <span class="fl">10</span>, </span>
<span>           xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">beta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">beta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>           drawlabels <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="Chapter06_files/figure-html/unnamed-chunk-44-1.png" class="r-plt" alt="" width="864"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sylvia Frühwirth-Schnatter, Bettina Grün, Gregor Kastner, Helga Wagner.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
